!function(){function t(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,a,s,o=[],h=!0,u=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;h=!1}else for(;!(h=(i=a.call(r)).done)&&(o.push(i.value),o.length!==e);h=!0);}catch(t){u=!0,n=t}finally{try{if(!h&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw n}}return o}}(t,r)||function(t,r){if(t){if("string"==typeof t)return e(t,r);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,r):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=Array(e);r<e;r++)i[r]=t[r];return i}function r(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return e};var t,e={},i=Object.prototype,n=i.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",h=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,i){var n=e&&e.prototype instanceof E?e:E,s=Object.create(n.prototype),o=new U(i||[]);return a(s,"_invoke",{value:M(t,r,o)}),s}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",p="suspendedYield",v="executing",g="completed",x={};function E(){}function T(){}function m(){}var _={};l(_,o,(function(){return this}));var b=Object.getPrototypeOf,A=b&&b(b(N([])));A&&A!==i&&n.call(A,o)&&(_=A);var y=m.prototype=E.prototype=Object.create(_);function R(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(i,a,s,o){var h=d(t[i],t,a);if("throw"!==h.type){var u=h.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,s,o)}),(function(t){r("throw",t,s,o)})):e.resolve(l).then((function(t){u.value=t,s(u)}),(function(t){return r("throw",t,s,o)}))}o(h.arg)}var i;a(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(a,a):a()}})}function M(e,r,i){var n=f;return function(a,s){if(n===v)throw Error("Generator is already running");if(n===g){if("throw"===a)throw s;return{value:t,done:!0}}for(i.method=a,i.arg=s;;){var o=i.delegate;if(o){var h=S(o,i);if(h){if(h===x)continue;return h}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===f)throw n=g,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=v;var u=d(e,r,i);if("normal"===u.type){if(n=i.done?g:p,u.arg===x)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(n=g,i.method="throw",i.arg=u.arg)}}}function S(e,r){var i=r.method,n=e.iterator[i];if(n===t)return r.delegate=null,"throw"===i&&e.iterator.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),x;var a=d(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,x;var s=a.arg;return s?s.done?(r[e.resultName]=s.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,x):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,x)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function U(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}return T.prototype=m,a(y,"constructor",{value:m,configurable:!0}),a(m,"constructor",{value:T,configurable:!0}),T.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===T||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},e.awrap=function(t){return{__await:t}},R(w.prototype),l(w.prototype,h,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,i,n,a){void 0===a&&(a=Promise);var s=new w(c(t,r,i,n),a);return e.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},R(y),l(y,u,"Generator"),l(y,o,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=N,U.prototype={constructor:U,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(i,n){return o.type="throw",o.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var h=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(h&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(h){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=t,s.arg=e,a?(this.method="next",this.next=a.finallyLoc,x):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),x},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),x}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;L(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:N(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),x}},e}function i(t,e,r,i,n,a,s){try{var o=t[a](s),h=o.value}catch(t){return void r(t)}o.done?e(h):Promise.resolve(h).then(i,n)}function n(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var s=t.apply(e,r);function o(t){i(s,n,a,o,h,"next",t)}function h(t){i(s,n,a,o,h,"throw",t)}o(void 0)}))}}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function s(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}System.register([],(function(e,i){"use strict";return{execute:function(){function i(t,e){}e({A:function(t){o="webgl"===t},a:i,c:g,d:function(t,e,r){var i=g(Math.max(t.x1,e.x1),Math.max(t.y1,e.y1),Math.min(t.x2,e.x2),Math.min(t.y2,e.y2),r);if(i.x1<i.x2&&i.y1<i.y2)return i;return g(0,0,0,0,i)},e:function(t,e,r){var i=Math.max(t.x,e.x),n=Math.max(t.y,e.y),a=Math.min(t.x+t.width,e.x+e.width)-i,s=Math.min(t.y+t.height,e.y+e.height)-n;if(a>0&&s>0)return r?(r.x=i,r.y=n,r.width=a,r.height=s,r):{x:i,y:n,width:a,height:s};if(r)return r.x=0,r.y=0,r.width=0,r.height=0,r;return{x:0,y:0,width:0,height:0}},f:function(t){return(255&t)/255},g:function(t){var e=Math.floor(255*t[0]),r=Math.floor(255*t[1]),i=Math.floor(255*t[2]),n=Math.floor(255*t[3]);return`rgba(${e},${r},${i},${n.toFixed(4)})`},h:function(t){return t.x1<t.x2&&t.y1<t.y2},i:u,j:function(t,e){return t.x1<e.x2&&t.x2>e.x1&&t.y1<e.y2&&t.y2>e.y1},l:function(t,e){if(e)return e.x=t.x1,e.y=t.y1,e.width=t.x2-t.x1,e.height=t.y2-t.y1,e;return{x:t.x1,y:t.y1,width:t.x2-t.x1,height:t.y2-t.y1}},m:function(t,e,r=!1){var i=(255&t)/255*e,n=o?i:1,a=Math.trunc((t>>>24)*n),s=Math.trunc((t>>>16&255)*n),h=Math.trunc((t>>>8&255)*n),u=Math.trunc(255*i);if(r)return(u<<24|h<<16|s<<8|a)>>>0;return(a<<24|s<<16|h<<8|u)>>>0},n:function(t,e){if(e)return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e;return{x:t.x,y:t.y,width:t.width,height:t.height}},p:function(t,e){var r=t>>>24,i=t>>>16&255,n=t>>>8&255,a=Math.trunc((255&t)*e);return(r<<24|i<<16|n<<8|a)>>>0},s:function(t,e,r){var i=Math.trunc(t>>>24),n=Math.trunc(t>>>16&255),a=Math.trunc(t>>>8&255),s=Math.trunc(255&t),o=Math.trunc(e>>>24),h=Math.trunc(e>>>16&255),u=Math.trunc(e>>>8&255),l=Math.trunc(255&e),c=Math.round(o*r+i*(1-r)),d=Math.round(h*r+n*(1-r)),f=Math.round(u*r+a*(1-r)),p=Math.round(l*r+s*(1-r));return(c<<24|d<<16|f<<8|p)>>>0},t:function(t,e){return t.x1<=e.x2&&t.y1<=e.y2&&t.x2>=e.x1&&t.y2>=e.y1}});var o=!0;function h(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function u(){return{BASE_URL:"/solid-demo-app/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,LEGACY:!0}&&!0}class l{constructor(){s(this,"eventListeners",{})}on(t,e){var r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){var r=this.eventListeners[t];if(r)if(e){var i=r.indexOf(e);i>=0&&r.splice(i,1)}else delete this.eventListeners[t]}once(t,e){var r=(i,n)=>{this.off(t,r),e(i,n)};this.on(t,r)}emit(t,e){var r=this.eventListeners[t];r&&[...r].forEach((t=>{t(this,e)}))}removeAllListeners(){this.eventListeners={}}}e("E",l);class c{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function d(t,e,r){var i=t.createShader(e);if(!i)throw new Error;if(t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}e("C",c);class f extends c{constructor(t){super(),s(this,"boundBufferCollection",null),s(this,"buffersBound",!1),s(this,"program",void 0),s(this,"vao",void 0),s(this,"renderer",void 0),s(this,"glw",void 0),s(this,"attributeBuffers",void 0),s(this,"attributeLocations",void 0),s(this,"attributeNames",void 0),s(this,"uniformLocations",void 0),s(this,"uniformTypes",void 0),s(this,"supportsIndexedTextures",void 0);var e=this.renderer=t.renderer,r=this.glw=this.renderer.glw;this.supportsIndexedTextures=t.supportsIndexedTextures||!1;var i=r.isWebGl2(),n=i&&t.webgl2Extensions||!i&&t.webgl1Extensions||[],a=i?"2.0":"1.0";n.forEach((t=>{if(!r.getExtension(t))throw new Error(`Shader "${this.constructor.name}" requires extension "${t}" for WebGL ${a} but wasn't found`)}));var o=t.shaderSources||this.constructor.shaderSources;if(!o)throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);i&&null!=o&&o.webGl2&&(o.fragment=o.webGl2.fragment,o.vertex=o.webGl2.vertex,delete o.webGl2);var h=e.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,u=o.vertex instanceof Function?o.vertex(h):o.vertex,l=o.fragment instanceof Function?o.fragment(h):o.fragment,c=d(r,r.VERTEX_SHADER,u),f=d(r,r.FRAGMENT_SHADER,l);if(!c||!f)throw new Error;var p=function(t,e,r){var i=t.createProgram();if(!i)throw new Error;if(t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return i;console.log(t.getProgramInfoLog(i)),t.deleteProgram(i)}(r,c,f);if(!p)throw new Error;if(this.program=p,i){var v=r.createVertexArray();if(!v)throw new Error;this.vao=v,r.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...t.attributes].forEach((t=>{var e=r.getAttribLocation(this.program,t);if(e<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${t}"!`);var i=r.createBuffer();if(!i)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${t}"`);this.attributeLocations[t]=e,this.attributeBuffers[t]=i,this.attributeNames.push(t)})),this.uniformLocations={},this.uniformTypes={},t.uniforms.forEach((t=>{var e=r.getUniformLocation(this.program,t.name);this.uniformTypes[t.name]=t.uniform,e?this.uniformLocations[t.name]=e:console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${t.name}"`)}))}bindBufferAttribute(t,e,r){var i=this.glw;i.enableVertexAttribArray(t),i.vertexAttribPointer(e,t,r.size,r.type,r.normalized,r.stride,r.offset)}disableAttribute(t){this.glw.disableVertexAttribArray(t)}disableAttributes(){for(var t in this.attributeLocations)this.disableAttribute(this.attributeLocations[t]);this.boundBufferCollection=null}canBatchShaderProps(t,e){return!1}bindRenderOp(t,e){this.bindBufferCollection(t.buffers),t.textures.length>0&&this.bindTextures(t.textures);var r=t.glw,i=t.parentHasRenderTexture;if(!t.renderToTexture||!i){if(i){var n=t.framebufferDimensions||{},a=n.width,s=n.height;this.setUniform("u_pixelRatio",1),this.setUniform("u_resolution",new Float32Array([null!=a?a:0,null!=s?s:0]))}else this.setUniform("u_pixelRatio",t.options.pixelRatio),this.setUniform("u_resolution",new Float32Array([r.canvas.width,r.canvas.height]));if(e){if(h(e,"$dimensions")){var o=e.$dimensions;o||(o=t.dimensions),this.setUniform("u_dimensions",[o.width,o.height])}if(h(e,"$alpha")){var u=e.$alpha;u||(u=t.alpha),this.setUniform("u_alpha",u)}this.bindProps(e)}}}setUniform(t,...e){this.glw.setUniform(this.uniformTypes[t],this.uniformLocations[t],...e)}bindBufferCollection(t){if(this.boundBufferCollection!==t){for(var e in this.attributeLocations){var r=t.getBuffer(e),i=t.getAttributeInfo(e);this.bindBufferAttribute(this.attributeLocations[e],r,i)}this.boundBufferCollection=t}}bindProps(t){}bindTextures(t){}attach(){this.glw.useProgram(this.program),this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}s(f,"shaderSources",void 0),e("W",f);class p extends l{constructor(t){super(),s(this,"txManager",void 0),s(this,"dimensions",null),s(this,"error",null),s(this,"state","freed"),s(this,"renderableOwners",new Set),this.txManager=t}setRenderableOwner(t,e){e?this.renderableOwners.add(t):this.renderableOwners.delete(t)}get renderable(){return this.renderableOwners.size>0}setState(t,...e){if(this.state!==t){if(this.state=t,"loaded"===t){var r=e;this.dimensions=r[0]}else if("failed"===t){var i=e;this.error=i[0]}this.emit(t,...e)}}static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}e("u",p);var v=e("b",(t=>[(t>>>24)/255,(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255]));e("z",(t=>[t>>>24,t>>>16&255,t>>>8&255,255&t]));function g(t,e,r,i,n){return n?(n.x1=t,n.y1=e,n.x2=r,n.y2=i,n):{x1:t,y1:e,x2:r,y2:i}}function x(t){if("file:"===self.location.protocol){var e=self.location.pathname.split("/");e.pop();var r=e.join("/"),i=self.location.protocol+"//"+r;return"."===t.charAt(0)&&(t=t.slice(1)),"/"===t.charAt(0)&&(t=t.slice(1)),i+"/"+t}return new URL(t,self.location.href).href}class E extends l{constructor(t){super(),s(this,"fontFamily",void 0),s(this,"descriptors",void 0),s(this,"loaded",!1),s(this,"metrics",null);var e=t.fontFamily,r=t.descriptors,i=t.metrics;i&&(this.metrics={ascender:i.ascender/i.unitsPerEm,descender:i.descender/i.unitsPerEm,lineGap:i.lineGap/i.unitsPerEm}),this.fontFamily=e,this.descriptors=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({style:"normal",weight:"normal",stretch:"normal"},r)}static convertToCssFontFaceDescriptors(t){return{style:t.style,weight:"number"==typeof t.weight?`${t.weight}`:t.weight,stretch:t.stretch,unicodeRange:t.unicodeRange,variant:t.variant,featureSettings:t.featureSettings,display:t.display}}}e("T",E);class T extends p{constructor(t,e){super(t),s(this,"props",void 0),this.props=T.resolveDefaults(e||{})}get color(){return this.props.color}set color(t){this.props.color=t}getTextureData(){var t=this;return n(r().mark((function e(){var i,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Uint32Array([t.color]),n=new Uint8ClampedArray(i.buffer),e.abrupt("return",{data:new ImageData(n,1,1),premultiplyAlpha:!0});case 3:case"end":return e.stop()}}),e)})))()}static makeCacheKey(t){return`ColorTexture,${T.resolveDefaults(t).color}`}static resolveDefaults(t){return{color:t.color||4294967295}}}s(T,"z$__type__Props",void 0),e("v",T);class m{constructor(t,e){s(this,"memManager",void 0),s(this,"textureSource",void 0),this.memManager=t,this.textureSource=e}}e("x",m);class _{constructor(t){s(this,"options",void 0),s(this,"mode",void 0),s(this,"stage",void 0),s(this,"txManager",void 0),s(this,"txMemManager",void 0),s(this,"shManager",void 0),s(this,"rttNodes",[]),this.options=t,this.stage=t.stage,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager}}e("y",_);class b{}class A extends b{constructor(t,e,r,i,n,a,o,h,u,l,c,d,f){super(),s(this,"glw",void 0),s(this,"options",void 0),s(this,"buffers",void 0),s(this,"shader",void 0),s(this,"shaderProps",void 0),s(this,"alpha",void 0),s(this,"clippingRect",void 0),s(this,"dimensions",void 0),s(this,"bufferIdx",void 0),s(this,"zIndex",void 0),s(this,"renderToTexture",void 0),s(this,"parentHasRenderTexture",void 0),s(this,"framebufferDimensions",void 0),s(this,"length",0),s(this,"numQuads",0),s(this,"textures",[]),s(this,"maxTextures",void 0),this.glw=t,this.options=e,this.buffers=r,this.shader=i,this.shaderProps=n,this.alpha=a,this.clippingRect=o,this.dimensions=h,this.bufferIdx=u,this.zIndex=l,this.renderToTexture=c,this.parentHasRenderTexture=d,this.framebufferDimensions=f,this.maxTextures=i.supportsIndexedTextures?t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(t){var e=this.textures,r=this.maxTextures,i=e.findIndex((e=>e===t));if(-1!==i)return i;var n=e.length;return n>=r?4294967295:(this.textures.push(t),n)}draw(){var t=this.glw,e=this.shader,r=this.shaderProps,i=this.options;i.shManager.useShader(e),e.bindRenderOp(this,r);var n=this.bufferIdx/24*6*2;if(this.clippingRect.valid){var a=this.clippingRect,s=a.x,o=a.y,h=a.width,u=a.height,l=i.pixelRatio,c=i.canvas.height,d=Math.round(s*l),f=Math.round(h*l),p=Math.round(u*l),v=Math.round(c-p-o*l);t.setScissorTest(!0),t.scissor(d,v,f,p)}else t.setScissorTest(!1);t.drawElements(t.TRIANGLES,6*this.numQuads,t.UNSIGNED_SHORT,n)}}function y(t){var e={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(e).forEach((r=>{e[r]=t.getParameter(t[r])})),e}function R(t){var e={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(e).forEach((r=>{e[r]=t.getExtension(r)})),e}e("o",A);var w=t=>t&&!(t&t-1),M=(t,e,r,i)=>{var n=3*t,a=3*(r-t)-n,s=1-n-a,o=3*e,h=3*(i-e)-o,u=1-o-h;return function(t){if(t>=1)return 1;if(t<=0)return 0;for(var e,r,i=.5,l=0;l<20;l++){if((r=t-i*(i*(i*s+a)+n))>-1e-8&&r<1e-8)return i*(i*(i*u+h)+o);if((e=i*(i*(3*s)+2*a)+n)>1e-10&&e<1e-10)break;i+=r/e}for(var c=0,d=1,f=0;f<20;f++){if((r=t-(i=.5*(c+d))*(i*(i*s+a)+n))>-1e-8&&r<1e-8)return i*(i*(i*u+h)+o);r<0?d=i:c=i}}},S={},I={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},L=t=>t;e("r",(e=>{if("linear"===e)return L;if(void 0!==S[e])return S[e]||L;if("step-start"===e)return()=>1;if("step-end"===e)return t=>1===t?1:0;if(void 0!==I[e]){var r=t(I[e],4),i=r[0],n=r[1],a=r[2],s=r[3],o=M(i,n,a,s);return S[e]=o,o}return e.startsWith("cubic-bezier")?(e=>{var r=e.match(/-?\d*\.?\d+/g);if(r){var i=t(r,4),n=i[0],a=i[1],s=i[2],o=i[3],h=parseFloat(n||"0.42"),u=parseFloat(a||"0"),l=parseFloat(s||"1"),c=parseFloat(o||"1"),d=M(h,u,l,c);return S[e]=d,d}return console.warn("Unknown cubic-bezier timing: "+e),L})(e):(console.warn("Unknown timing function: "+e),L)}));Math.hypot||(Math.hypot=(...t)=>{for(var e=0,r=t.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var U=new Uint8Array([0,0,0,0]);class N extends m{constructor(t,e,r){super(e,r),s(this,"glw",void 0),s(this,"_nativeCtxTexture",null),s(this,"_state","freed"),s(this,"_w",0),s(this,"_h",0),this.glw=t}get ctxTexture(){return"freed"===this._state&&this.load(),this._nativeCtxTexture,this._nativeCtxTexture}get renderable(){return this.textureSource.renderable}get w(){return this._w}get h(){return this._h}load(){"loading"!==this._state&&"loaded"!==this._state&&(this._state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this.onLoadRequest().then((({width:t,height:e})=>{"freed"!==this._state&&(this._state="loaded",this._w=t,this._h=e,this.textureSource.setState("loaded",{width:t,height:e}))})).catch((t=>{"freed"!==this._state&&(this._state="failed",this.textureSource.setState("failed",t),console.error(t))})))}onLoadRequest(){var t=this;return n(r().mark((function e(){var i,n,a,s,o,h,u,l,c,d,f,p,v,g,x,E,T;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.glw,a=t.memManager,n.texImage2D(0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,null),a.setTextureMemUse(t,U.byteLength),e.next=5,null===(i=t.textureSource)||void 0===i?void 0:i.getTextureData();case 5:if(s=e.sent,t._nativeCtxTexture){e.next=9;break}return t._state,e.abrupt("return",{width:0,height:0});case 9:return o=0,h=0,t._nativeCtxTexture,n.activeTexture(0),s.data instanceof ImageBitmap||s.data instanceof ImageData||null!==(r=s.data)&&"object"==typeof r&&r.constructor&&"HTMLImageElement"===r.constructor.name?(u=s.data,o=u.width,h=u.height,n.bindTexture(t._nativeCtxTexture),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!s.premultiplyAlpha),n.texImage2D(0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,u),a.setTextureMemUse(t,o*h*4),(n.isWebGl2()||w(o)&&w(h))&&n.generateMipmap()):null===s.data?(o=0,h=0,n.bindTexture(t._nativeCtxTexture),n.texImage2D(0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,U),a.setTextureMemUse(t,U.byteLength)):"mipmaps"in s.data&&s.data.mipmaps?(c=s.data,d=c.mipmaps,f=c.width,p=void 0===f?0:f,v=c.height,g=void 0===v?0:v,x=c.type,E=c.glInternalFormat,T="ktx"===x?new DataView(null!==(l=d[0])&&void 0!==l?l:new ArrayBuffer(0)):d[0],n.bindTexture(t._nativeCtxTexture),n.compressedTexImage2D(0,E,p,g,0,T),n.texParameteri(n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_MIN_FILTER,n.LINEAR),a.setTextureMemUse(t,T.byteLength)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",s),e.abrupt("return",{width:o,height:h});case 15:case"end":return e.stop()}var r}),e)})))()}free(){if("freed"!==this._state&&(this._state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,this._nativeCtxTexture)){var t=this.glw,e=this.memManager;t.deleteTexture(this._nativeCtxTexture),e.setTextureMemUse(this,0),this._nativeCtxTexture=null}}createNativeCtxTexture(){var t=this.glw,e=t.createTexture();if(!e)throw new Error("Could not create WebGL Texture");return t.activeTexture(0),t.bindTexture(e),t.texParameteri(t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e}}class P extends p{constructor(t,e){super(t),s(this,"props",void 0),s(this,"parentTexture",void 0),s(this,"onParentTxLoaded",(()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})})),s(this,"onParentTxFailed",((t,e)=>{this.setState("failed",e)})),this.parentTexture=this.txManager.loadTexture(e.texture.txType,e.texture.props,e.texture.options),this.props=P.resolveDefaults(e||{}),queueMicrotask((()=>{var t=this.parentTexture;"loaded"===t.state?this.onParentTxLoaded(t,t.dimensions):"failed"===t.state&&this.onParentTxFailed(t,t.error),t.on("loaded",this.onParentTxLoaded),t.on("failed",this.onParentTxFailed)}))}getTextureData(){var t=this;return n(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:t.props});case 1:case"end":return e.stop()}}),e)})))()}static makeCacheKey(t){return!1}static resolveDefaults(t){return{texture:t.texture,x:t.x||0,y:t.y||0,width:t.width||0,height:t.height||0}}}s(P,"z$__type__Props",void 0),e("w",P);class O extends N{constructor(t,e,r){super(t,e,r)}onLoadRequest(){var t=this;return n(r().mark((function e(){var i,n,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.textureSource.getTextureData();case 2:return a=e.sent,e.abrupt("return",{width:(null===(i=a.data)||void 0===i?void 0:i.width)||0,height:(null===(n=a.data)||void 0===n?void 0:n.height)||0});case 4:case"end":return e.stop()}}),e)})))()}}class B{constructor(t){s(this,"config",void 0),this.config=t}getBuffer(t){var e;return null===(e=this.config.find((e=>e.attributes[t])))||void 0===e?void 0:e.buffer}getAttributeInfo(t){var e;return null===(e=this.config.find((e=>e.attributes[t])))||void 0===e?void 0:e.attributes[t]}}e("B",B);class D{constructor(t){s(this,"gl",void 0),s(this,"activeTextureUnit",0),s(this,"texture2dUnits",void 0),s(this,"texture2dParams",new WeakMap),s(this,"scissorEnabled",void 0),s(this,"scissorX",void 0),s(this,"scissorY",void 0),s(this,"scissorWidth",void 0),s(this,"scissorHeight",void 0),s(this,"blendEnabled",void 0),s(this,"blendSrcRgb",void 0),s(this,"blendDstRgb",void 0),s(this,"blendSrcAlpha",void 0),s(this,"blendDstAlpha",void 0),s(this,"boundArrayBuffer",void 0),s(this,"boundElementArrayBuffer",void 0),s(this,"curProgram",void 0),s(this,"programUniforms",new WeakMap),s(this,"canvas",void 0),s(this,"MAX_RENDERBUFFER_SIZE",void 0),s(this,"MAX_TEXTURE_SIZE",void 0),s(this,"MAX_VIEWPORT_DIMS",void 0),s(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS",void 0),s(this,"MAX_TEXTURE_IMAGE_UNITS",void 0),s(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS",void 0),s(this,"MAX_VERTEX_ATTRIBS",void 0),s(this,"MAX_VARYING_VECTORS",void 0),s(this,"MAX_VERTEX_UNIFORM_VECTORS",void 0),s(this,"MAX_FRAGMENT_UNIFORM_VECTORS",void 0),s(this,"TEXTURE_MAG_FILTER",void 0),s(this,"TEXTURE_MIN_FILTER",void 0),s(this,"TEXTURE_WRAP_S",void 0),s(this,"TEXTURE_WRAP_T",void 0),s(this,"LINEAR",void 0),s(this,"CLAMP_TO_EDGE",void 0),s(this,"RGBA",void 0),s(this,"UNSIGNED_BYTE",void 0),s(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL",void 0),s(this,"UNPACK_FLIP_Y_WEBGL",void 0),s(this,"FLOAT",void 0),s(this,"TRIANGLES",void 0),s(this,"UNSIGNED_SHORT",void 0),s(this,"ONE",void 0),s(this,"ONE_MINUS_SRC_ALPHA",void 0),s(this,"VERTEX_SHADER",void 0),s(this,"FRAGMENT_SHADER",void 0),s(this,"STATIC_DRAW",void 0),s(this,"COMPILE_STATUS",void 0),s(this,"LINK_STATUS",void 0),s(this,"DYNAMIC_DRAW",void 0),s(this,"COLOR_ATTACHMENT0",void 0),this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map(((e,r)=>(this.activeTexture(r),t.getParameter(t.TEXTURE_BINDING_2D)))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);var r=t.getParameter(t.SCISSOR_BOX);this.scissorX=r[0],this.scissorY=r[1],this.scissorWidth=r[2],this.scissorHeight=r[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0}isWebGl2(){return t=this.gl,self.WebGL2RenderingContext&&t instanceof self.WebGL2RenderingContext;var t}activeTexture(t){var e=this.gl;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){var e=this.gl,r=this.activeTextureUnit,i=this.texture2dUnits;i[r]!==t&&(i[r]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){var t=this.activeTextureUnit;return this.texture2dUnits[t]}texParameteri(t,e){var r=this.gl,i=this.texture2dParams,n=this._getActiveTexture();if(!n)throw new Error("No active texture");var a=i.get(n);a||(a={},i.set(n,a)),a[t]!==e&&(a[t]=e,r.texParameteri(r.TEXTURE_2D,t,e))}texImage2D(t,e,r,i,n,a,s,o){var h=this.gl;a?h.texImage2D(h.TEXTURE_2D,t,e,r,i,n,a,s,o):h.texImage2D(h.TEXTURE_2D,t,e,r,i,n)}compressedTexImage2D(t,e,r,i,n,a){var s=this.gl;s.compressedTexImage2D(s.TEXTURE_2D,t,e,r,i,n,a)}pixelStorei(t,e){this.gl.pixelStorei(t,e)}generateMipmap(){var t=this.gl;t.generateMipmap(t.TEXTURE_2D)}createTexture(){return this.gl.createTexture()}deleteTexture(t){var e=this.gl;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}viewport(t,e,r,i){this.gl.viewport(t,e,r,i)}clearColor(t,e,r,i){this.gl.clearColor(t,e,r,i)}setScissorTest(t){var e=this.gl;t!==this.scissorEnabled&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,r,i){var n=this.gl,a=this.scissorX,s=this.scissorY,o=this.scissorWidth,h=this.scissorHeight;t===a&&e===s&&r===o&&i===h||(n.scissor(t,e,r,i),this.scissorX=t,this.scissorY=e,this.scissorWidth=r,this.scissorHeight=i)}setBlend(t){var e=this.gl;t!==this.blendEnabled&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){var r=this.gl,i=this.blendSrcRgb,n=this.blendDstRgb,a=this.blendSrcAlpha,s=this.blendDstAlpha;t===i&&e===n&&t===a&&e===s||(r.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){return this.gl.createBuffer()}createFramebuffer(){return this.gl.createFramebuffer()}bindFramebuffer(t){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,r){var i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e,r)}clear(){var t=this.gl;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,r){var i=this.gl;this.boundArrayBuffer!==t&&(i.bindBuffer(i.ARRAY_BUFFER,t),this.boundArrayBuffer=t),i.bufferData(i.ARRAY_BUFFER,e,r)}elementArrayBufferData(t,e,r){var i=this.gl;this.boundElementArrayBuffer!==t&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,r)}vertexAttribPointer(t,e,r,i,n,a,s){var o=this.gl;this.boundArrayBuffer!==t&&(o.bindBuffer(o.ARRAY_BUFFER,t),this.boundArrayBuffer=t),o.vertexAttribPointer(e,r,i,n,a,s)}useProgram(t){var e=this.gl;this.curProgram!==t&&(e.useProgram(t),this.curProgram=t)}setUniform(t,e,...r){var i=this.gl,n=this.programUniforms,a=n.get(this.curProgram);a||(a=new Map,n.set(this.curProgram,a));var s=a.get(e);s&&function(t,e){if(t.length!==e.length)return!1;return t.every(((t,r)=>!(Array.isArray(t)||t instanceof Float32Array)&&t===e[r]))}(s,r)||(a.set(e,r),i[t](e,...r))}getParameter(t){return this.gl.getParameter(t)}drawElements(t,e,r,i){this.gl.drawElements(t,e,r,i)}getExtension(t){return this.gl.getExtension(t)}createVertexArray(){var t=this.gl;return WebGL2RenderingContext,t.createVertexArray()}bindVertexArray(t){var e=this.gl;WebGL2RenderingContext,e.bindVertexArray(t)}getAttribLocation(t,e){return this.gl.getAttribLocation(t,e)}getUniformLocation(t,e){return this.gl.getUniformLocation(t,e)}enableVertexAttribArray(t){this.gl.enableVertexAttribArray(t)}disableVertexAttribArray(t){this.gl.disableVertexAttribArray(t)}createShader(t){return this.gl.createShader(t)}compileShader(t){this.gl.compileShader(t)}attachShader(t,e){this.gl.attachShader(t,e)}linkProgram(t){this.gl.linkProgram(t)}deleteProgram(t){this.gl.deleteProgram(t)}getShaderParameter(t,e){return this.gl.getShaderParameter(t,e)}getShaderInfoLog(t){return this.gl.getShaderInfoLog(t)}createProgram(){return this.gl.createProgram()}getProgramParameter(t,e){return this.gl.getProgramParameter(t,e)}getProgramInfoLog(t){return this.gl.getProgramInfoLog(t)}shaderSource(t,e){this.gl.shaderSource(t,e)}deleteShader(t){this.gl.deleteShader(t)}}class C extends p{constructor(t,e){super(t),s(this,"props",void 0),this.props=C.resolveDefaults(e||{})}get width(){return this.props.width}set width(t){this.props.width=t}get height(){return this.props.height}set height(t){this.props.height=t}getTextureData(){return n(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{data:null,premultiplyAlpha:null});case 1:case"end":return t.stop()}}),t)})))()}static resolveDefaults(t){return{width:t.width||256,height:t.height||256}}}s(C,"z$__type__Props",void 0),e("R",C);class X extends N{constructor(t,e,r){super(t,e,r),s(this,"framebuffer",void 0);var i=t.createFramebuffer();this.framebuffer=i}onLoadRequest(){var t=this;return n(r().mark((function e(){var i,n,a,s,o,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.glw,n=t.memManager,a=t._nativeCtxTexture=t.createNativeCtxTexture(),s=t.textureSource,o=s.width,h=s.height,i.texImage2D(0,i.RGBA,o,h,0,i.RGBA,i.UNSIGNED_BYTE,null),n.setTextureMemUse(t,o*h*4),i.bindFramebuffer(t.framebuffer),i.framebufferTexture2D(i.COLOR_ATTACHMENT0,a,0),i.bindFramebuffer(null),e.abrupt("return",{width:o,height:h});case 9:case"end":return e.stop()}}),e)})))()}}var G=function(){var t=n(r().mark((function t(e){var i,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return i=t.sent,t.next=5,i.arrayBuffer();case 5:if(n=t.sent,-1===e.indexOf(".ktx")){t.next=8;break}return t.abrupt("return",F(n));case 8:return t.abrupt("return",k(n));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),F=function(){var t=n(r().mark((function t(e){var i,n,a,s,o,h,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=new DataView(e),n=16909060===i.getUint32(12),a=[],s={glInternalFormat:i.getUint32(28,n),pixelWidth:i.getUint32(36,n),pixelHeight:i.getUint32(40,n),numberOfMipmapLevels:i.getUint32(56,n),bytesOfKeyValueData:i.getUint32(60,n)},o=64,o+=s.bytesOfKeyValueData,h=0;h<s.numberOfMipmapLevels;h++)u=i.getUint32(o),o+=4,a.push(i.buffer.slice(o,u)),o+=u;return t.abrupt("return",{data:{glInternalFormat:s.glInternalFormat,mipmaps:a,width:s.pixelWidth||0,height:s.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),k=function(){var t=n(r().mark((function t(e){var i,n,a,s,o,h,u,l,c,d,f,p;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(13,36196,7,6,11,12,i=e,n=new Int32Array(i,0,13),a=n[12]+52,s=new Uint8Array(i,a),o=[],h={pixelWidth:n[7],pixelHeight:n[6],numberOfMipmapLevels:n[11]||0},u=0,l=h.pixelWidth||0,c=h.pixelHeight||0,d=0;d<h.numberOfMipmapLevels;d++)f=(l+3>>2)*(c+3>>2)*8,p=new Uint8Array(i,s.byteOffset+u,f),o.push(p),u+=f,l>>=1,c>>=1;return t.abrupt("return",{data:{glInternalFormat:36196,mipmaps:o,width:h.pixelWidth||0,height:h.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1});case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();class W extends p{constructor(t,e){super(t),s(this,"props",void 0),this.props=W.resolveDefaults(e)}hasAlphaChannel(t){return-1!==t.indexOf("image/png")}getTextureData(){var t=this;return n(r().mark((function e(){var i,n,a,s,o,h,u,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props,n=i.src,a=i.premultiplyAlpha,n){e.next=3;break}return e.abrupt("return",{data:null});case 3:if("string"==typeof n){e.next=7;break}if(!(n instanceof ImageData)){e.next=6;break}return e.abrupt("return",{data:n,premultiplyAlpha:a});case 6:return e.abrupt("return",{data:n(),premultiplyAlpha:a});case 7:if(!/\.(ktx|pvr)$/.test(n)){e.next=9;break}return e.abrupt("return",G(n));case 9:if(s=x(n),!t.txManager.imageWorkerManager){e.next=16;break}return e.next=13,t.txManager.imageWorkerManager.getImage(s,a);case 13:return e.abrupt("return",e.sent);case 16:if(!t.txManager.hasCreateImageBitmap){e.next=31;break}return e.next=19,fetch(s);case 19:return o=e.sent,e.next=22,o.blob();case 22:return h=e.sent,u=null!=a?a:t.hasAlphaChannel(h.type),e.next=26,createImageBitmap(h,{premultiplyAlpha:u?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"});case 26:return e.t0=e.sent,e.t1=u,e.abrupt("return",{data:e.t0,premultiplyAlpha:e.t1});case 31:return l=new Image,"data:"!==n.substr(0,5)&&(l.crossOrigin="Anonymous"),l.src=s,e.next=36,new Promise(((t,e)=>{l.onload=()=>t(),l.onerror=()=>e(new Error("Failed to load image"))})).catch((t=>{console.error(t)}));case 36:return e.abrupt("return",{data:l,premultiplyAlpha:null==a||a});case 37:case"end":return e.stop()}}),e)})))()}static makeCacheKey(t){var e,r=W.resolveDefaults(t),i=r.key||r.src;return"string"==typeof i&&`ImageTexture,${i},${null!==(e=r.premultiplyAlpha)&&void 0!==e?e:"true"}`}static resolveDefaults(t){var e,r,i;return{src:null!==(e=t.src)&&void 0!==e?e:"",premultiplyAlpha:null===(r=t.premultiplyAlpha)||void 0===r||r,key:null!==(i=t.key)&&void 0!==i?i:null}}}s(W,"z$__type__Props",void 0),e("I",W);class V extends _{constructor(t){super(t),s(this,"glw",void 0),s(this,"system",void 0),s(this,"quadBuffer",new ArrayBuffer(4194304)),s(this,"fQuadBuffer",new Float32Array(this.quadBuffer)),s(this,"uiQuadBuffer",new Uint32Array(this.quadBuffer)),s(this,"renderOps",[]),s(this,"curBufferIdx",0),s(this,"curRenderOp",null),s(this,"rttNodes",[]),s(this,"activeRttNode",null),s(this,"defaultShader",void 0),s(this,"quadBufferCollection",void 0),s(this,"defaultTexture",void 0),s(this,"renderToTextureActive",!1),this.mode="webgl";var e=t.canvas,r=t.clearColor,i=t.bufferMemory;this.defaultTexture=new T(this.txManager),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",(()=>{this.stage.requestRender()}));var n=function(t,e){var r={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},i=t.getContext("webgl",r)||t.getContext("experimental-webgl",r);if(!i)throw new Error("Unable to create WebGL context");return e?new Proxy(i,{get(t,r){var i=t[r];return"function"==typeof i?(e.increment(String(r)),i.bind(t)):i}}):i}(e,t.contextSpy),a=this.glw=new D(n),o=v(r);a.viewport(0,0,e.width,e.height),a.clearColor(o[0],o[1],o[2],o[3]),a.setBlend(!0),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),function(t,e){for(var r=~~(e/80),i=new Uint16Array(6*r),n=0,a=0;n<r;n+=6,a+=4)i[n]=a,i[n+1]=a+1,i[n+2]=a+2,i[n+3]=a+2,i[n+4]=a+1,i[n+5]=a+3;var s=t.createBuffer();t.elementArrayBufferData(s,i,t.STATIC_DRAW)}(a,i),this.system={parameters:y(this.glw),extensions:R(this.glw)},this.shManager.renderer=this,this.defaultShader=this.shManager.loadShader("DefaultShader").shader;var h=a.createBuffer(),u=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new B([{buffer:h,attributes:{a_position:{name:"a_position",size:2,type:a.FLOAT,normalized:!1,stride:u,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:a.FLOAT,normalized:!1,stride:u,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:a.UNSIGNED_BYTE,normalized:!0,stride:u,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:a.FLOAT,normalized:!1,stride:u,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){var t=this.glw;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,t.setScissorTest(!1),t.clear()}getShaderManager(){return this.shManager}createCtxTexture(t){return t instanceof P?new O(this.glw,this.txMemManager,t):t instanceof C?new X(this.glw,this.txMemManager,t):new N(this.glw,this.txMemManager,t)}addQuad(t){var e,r,i,n,a=this.fQuadBuffer,s=this.uiQuadBuffer,o=t.width,u=t.height,l=t.colorTl,c=t.colorTr,d=t.colorBl,f=t.colorBr,p=t.textureOptions,v=t.shader,g=t.shaderProps,x=t.alpha,E=t.clippingRect,T=t.tx,m=t.ty,_=t.ta,b=t.tb,A=t.tc,y=t.td,R=t.rtt,w=t.parentHasRenderTexture,M=t.framebufferDimensions,S=t.texture;if(g&&h(g,"$dimensions")){var I=g.$dimensions;I.width=o,I.height=u}S=null!==(e=S)&&void 0!==e?e:this.defaultTexture;var L=this.curBufferIdx,U=this.curRenderOp,N={width:o,height:u},O=v||this.defaultShader;this.reuseRenderOp(t)||(this.newRenderOp(O,g,x,N,E,L,R,w,M),U=this.curRenderOp);var B=null!==(r=null==p?void 0:p.flipX)&&void 0!==r&&r,D=null!==(i=null==p?void 0:p.flipY)&&void 0!==i&&i,C=0,X=0,G=1,F=1;if(S instanceof P){var k=S.props,V=k.x,H=k.y,Y=k.width,j=k.height,$=S.parentTexture.dimensions||{width:0,height:0},z=$.width,K=void 0===z?0:z,q=$.height,Q=void 0===q?0:q;G=(C=V/K)+Y/K,F=(X=H/Q)+j/Q,S=S.parentTexture}var Z=null!==(n=null==p?void 0:p.resizeMode)&&void 0!==n&&n;if(S instanceof W&&Z&&S.dimensions){var J=S.dimensions,tt=J.width,et=J.height;if("cover"===Z.type){var rt=o/tt,it=u/et,nt=Math.max(rt,it),at=1/nt;if(nt&&rt&&rt<nt){var st,ot=at*o;G=(C=(1-ot/tt)*(null!==(st=Z.clipX)&&void 0!==st?st:.5))+ot/tt}if(nt&&it&&it<nt){var ht,ut=at*u;F=(X=(1-ut/et)*(null!==(ht=Z.clipY)&&void 0!==ht?ht:.5))+ut/et}}}if(B){var lt=[G,C];C=lt[0],G=lt[1]}if(D){var ct=[F,X];X=ct[0],F=ct[1]}var dt=this.stage.txManager.getCtxTexture(S),ft=this.addTexture(dt,L);if(U=this.curRenderOp,0!==b||0!==A)a[L++]=T,a[L++]=m,a[L++]=C,a[L++]=X,s[L++]=l,a[L++]=ft,a[L++]=T+o*_,a[L++]=m+o*A,a[L++]=G,a[L++]=X,s[L++]=c,a[L++]=ft,a[L++]=T+u*b,a[L++]=m+u*y,a[L++]=C,a[L++]=F,s[L++]=d,a[L++]=ft,a[L++]=T+o*_+u*b,a[L++]=m+o*A+u*y,a[L++]=G,a[L++]=F,s[L++]=f,a[L++]=ft;else{var pt=T+o*_,vt=m+u*y;a[L++]=T,a[L++]=m,a[L++]=C,a[L++]=X,s[L++]=l,a[L++]=ft,a[L++]=pt,a[L++]=m,a[L++]=G,a[L++]=X,s[L++]=c,a[L++]=ft,a[L++]=T,a[L++]=vt,a[L++]=C,a[L++]=F,s[L++]=d,a[L++]=ft,a[L++]=pt,a[L++]=vt,a[L++]=G,a[L++]=F,s[L++]=f,a[L++]=ft}U.length+=24,U.numQuads++,this.curBufferIdx=L}newRenderOp(t,e,r,i,n,a,s,o,h){var u=new A(this.glw,this.options,this.quadBufferCollection,t,e,r,n,i,a,0,s,o,h);this.curRenderOp=u,this.renderOps.push(u)}addTexture(t,e,r){var i=this.curRenderOp,n=i.addTexture(t);if(4294967295===n){if(r)throw new Error("Unable to add texture to render op");var a=i.shader,s=i.shaderProps,o=i.dimensions,h=i.clippingRect,u=i.alpha;return this.newRenderOp(a,s,u,o,h,e),this.addTexture(t,e,!0)}return n}reuseRenderOp(t){var e,r,i,n=t.shader,a=t.shaderProps,s=t.parentHasRenderTexture,o=t.rtt,h=t.clippingRect,u=n||this.defaultShader;return(null===(e=this.curRenderOp)||void 0===e?void 0:e.shader)===u&&(((r=this.curRenderOp.clippingRect)===(i=h)||null!==r&&null!==i&&r.x===i.x&&r.y===i.y&&r.width===i.width&&r.height===i.height)&&(!s&&!o&&!!(this.curRenderOp.shader===this.defaultShader||a&&this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,a))))}addRenderOp(t){this.renderOps.push(t),this.curRenderOp=null}render(t="screen"){var e,r=this.glw,i=this.quadBuffer,n=new Float32Array(i,0,this.curBufferIdx),a=null!==(e=this.quadBufferCollection.getBuffer("a_position"))&&void 0!==e?e:null;r.arrayBufferData(a,n,r.STATIC_DRAW),this.renderOps.forEach(((t,e)=>{t.draw()}))}renderToTexture(t){for(var e=0;e<this.rttNodes.length;e++)if(this.rttNodes[e]===t)return;this.rttNodes.unshift(t)}renderRTTNodes(){for(var t=this.glw,e=this.stage.txManager,r=0;r<this.rttNodes.length;r++){var i=this.rttNodes[r];if(i&&i.hasRTTupdates){this.activeRttNode=i,i.texture;var n=e.getCtxTexture(i.texture);this.renderToTextureActive=!0,t.bindFramebuffer(n.framebuffer),t.viewport(0,0,n.w,n.h),t.clear();for(var a=0;a<i.children.length;a++){var s=i.children[a];s&&(s.update(this.stage.deltaTime,{x:0,y:0,width:0,height:0,valid:!1}),this.stage.addQuads(s),s.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,i.hasRTTupdates=!1}}t.bindFramebuffer(null),t.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(t){var e=this.rttNodes.indexOf(t);-1!==e&&this.rttNodes.splice(e,1)}}e("k",V);var H=10;class Y{}class j extends Y{constructor(t,e){super(),s(this,"data",void 0),s(this,"glyphMap",void 0),s(this,"kernings",void 0),this.data=t,this.glyphMap=e;var r=this.kernings={};t.kernings.forEach((t=>{var e=t.second;(r[e]=r[e]||{})[t.first]=t.amount})),this.kernings=r}shapeText(t,e){var i=this;return r().mark((function n(){var a,s,o,h,u,l;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s=void 0;case 1:if(!(a=e.peek())||a.done){r.next=17;break}if(o=a.value,h=i.glyphMap.get(o),e.next(),void 0===h){r.next=12;break}return l=void 0!==s?((null===(u=i.kernings[h.id])||void 0===u?void 0:u[s])||0)+t.letterSpacing:0,s=h.id,r.next=10,{mapped:!0,glyphId:h.id,codepoint:o,cluster:e.lastIndex,xAdvance:h.xadvance+l,yAdvance:0,xOffset:h.xoffset+l,yOffset:h.yoffset,xBearing:0,yBearing:0,width:h.width,height:h.height};case 10:r.next=15;break;case 12:return o===H&&(s=void 0),r.next=15,{mapped:!1,codepoint:o,cluster:e.lastIndex};case 15:r.next=1;break;case 17:case"end":return r.stop()}}),n)}))()}}e("S",class extends E{constructor(t,e){var i;super(e),i=this,s(this,"type",void 0),s(this,"texture",void 0),s(this,"maxCharHeight",0),s(this,"data",void 0),s(this,"shaper",void 0),s(this,"glyphMap",new Map);var a=e.atlasUrl,o=e.atlasDataUrl,h=e.stage;this.type=t;h.renderer;this.texture=h.txManager.loadTexture("ImageTexture",{src:a,premultiplyAlpha:!1},{preload:!0}),this.texture.on("loaded",(()=>{this.checkLoaded()})),fetch(o).then(function(){var t=n(r().mark((function t(e){var n,a,s,o,h,u,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.json();case 2:if(i.data=t.sent,i.data,n=0,i.data.chars.forEach((t=>{i.glyphMap.set(t.id,t);var e=t.yoffset+t.height;e>n&&(n=e)})),i.maxCharHeight=n,i.shaper=new j(i.data,i.glyphMap),i.metrics){t.next=15;break}if(null===(a=i.data)||void 0===a||!a.lightningMetrics){t.next=14;break}s=i.data.lightningMetrics,o=s.ascender,h=s.descender,u=s.lineGap,l=s.unitsPerEm,i.metrics={ascender:o/l,descender:h/l,lineGap:u/l},t.next=15;break;case 14:throw new Error(`Font metrics not found in ${i.type} font ${i.fontFamily}. Make sure you are using the latest version of the Lightning 3 \`msdf-generator\` tool to generate your SDF fonts.`);case 15:i.checkLoaded();case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch(console.error)}getAtlasEntry(t){var e=this.glyphMap.get(t);if(void 0===e)throw new Error(`Glyph ${t} not found in font ${this.fontFamily}`);return{x:e.x,y:e.y,width:e.width,height:e.height}}checkLoaded(){this.loaded||"loaded"===this.texture.state&&this.data&&(this.loaded=!0,this.emit("loaded"))}});e("q",class{})}}}))}();
//# sourceMappingURL=CoreExtension-legacy-CRBvCdMm.js.map

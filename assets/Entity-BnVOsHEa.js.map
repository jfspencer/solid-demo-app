{"version":3,"file":"Entity-BnVOsHEa.js","sources":["../../src/pages/Entity.tsx"],"sourcesContent":["import {\n  ElementNode,\n  Text,\n  View,\n  Show,\n  assertTruthy,\n  setActiveElement,\n} from \"@lightningtv/solid\";\nimport { Column, Row } from \"@lightningtv/solid/primitives\";\n\nimport { createEffect, on, createSignal } from \"solid-js\";\nimport { TileRow, Button } from \"../components\";\nimport { setGlobalBackground } from \"../state\";\nimport ContentBlock from \"../components/ContentBlock\";\nimport { useNavigate } from \"@solidjs/router\";\nimport styles from \"../styles\";\nimport * as player from \"../video\";\n\nconst Entity = (props) => {\n  const [backdropAlpha, setBackdropAlpha] = createSignal(0);\n  const navigate = useNavigate();\n\n  createEffect(\n    on(\n      props.data.entity,\n      (data) => {\n        setGlobalBackground(data.backgroundImage);\n      },\n      { defer: true }\n    )\n  );\n\n  const columnY = 640;\n\n  const Backdrop = {\n    color: \"#000000\",\n    alpha: 0,\n    width: 1900,\n    height: 890,\n    x: -160,\n    y: columnY,\n    borderRadius: 30,\n  };\n\n  function onRowFocus(this: ElementNode) {\n    this.children[this.selected || 0].setFocus();\n    columnRef.y = columnY;\n    backdropRef.y = columnY;\n    backdropRef.alpha = 0;\n  }\n\n  function onRowFocusAnimate(this: ElementNode) {\n    this.children[this.selected || 0].setFocus();\n    columnRef.y = 200;\n    backdropRef.y = 160;\n    backdropRef.alpha = 0.9;\n  }\n\n  function onEnter(this: ElementNode) {\n    let entity = this.children.find((c) => c.states.has(\"focus\"));\n    assertTruthy(entity && entity.item?.href);\n    navigate(entity.item.href as string);\n  }\n\n  function onEscape() {\n    //closeVideo();\n    // Set focus back to lightning app\n    document.getElementsByTagName(\"canvas\")[0].focus();\n    entityActions.setFocus();\n    setBackdropAlpha(0);\n  }\n\n  function onEnterTrailer() {\n    //const video = playVideo();\n    //setActiveElement(video);\n    setBackdropAlpha(0.9);\n  }\n\n  let columnRef, backdropRef, entityActions;\n\n  /**\n   * I used to have keyed on Show - This would cause the entire tree to be destroyed and recreated. Without keyed, the data is diffed and the nodes are reused and passed in new props.\n   * Only one element gets deleted and recreated - a text node for reviews.\n   *\n   * However this causes problems with elements which have internal state like Row & Column because the selected does not get reset.\n   */\n  return (\n    <Show when={props.data.entity()}>\n      <View x={170} onUp={() => entityActions.setFocus()} onEscape={onEscape}>\n        <ContentBlock\n          y={260}\n          content={props.data.entity().heroContent}\n        ></ContentBlock>\n        <Row\n          ref={entityActions}\n          y={500}\n          scroll=\"none\"\n          height={90}\n          width={640}\n          gap={40}\n          onDown={() => columnRef.setFocus()}\n          onEnter={onEnterTrailer}\n        >\n          <Button width={300} autofocus={props.data.entity()}>\n            Play\n          </Button>\n          <Button width={300}>Resume</Button>\n        </Row>\n\n        <Column\n          ref={columnRef}\n          x={0}\n          y={columnY}\n          style={styles.Column}\n          height={880}\n          scroll=\"none\"\n          zIndex={5}\n        >\n          <Show when={props.data.recommendations() && props.data.credits()}>\n            <Text skipFocus style={styles.RowTitle}>\n              Recommendations\n            </Text>\n            <TileRow\n              onFocus={onRowFocus}\n              onEnter={onEnter}\n              items={props.data.recommendations()}\n              width={1620}\n            />\n            <Text skipFocus style={styles.RowTitle}>\n              Cast and Crew\n            </Text>\n            <TileRow\n              onFocus={onRowFocusAnimate}\n              onEnter={onEnter}\n              items={props.data.credits()}\n              width={1620}\n            />\n          </Show>\n        </Column>\n        <View\n          ref={backdropRef}\n          style={Backdrop}\n          transition={{ alpha: true, y: true }}\n        />\n      </View>\n      <View\n        alpha={backdropAlpha()}\n        color={\"#000000\"}\n        skipFocus\n        zIndex={200}\n        transition={{ alpha: true }}\n      />\n    </Show>\n  );\n};\n\nexport default Entity;\n"],"names":["Entity","props","backdropAlpha","setBackdropAlpha","createSignal","navigate","useNavigate","createEffect","on","data","entity","setGlobalBackground","backgroundImage","defer","columnY","Backdrop","color","alpha","width","height","x","y","borderRadius","onRowFocus","children","selected","setFocus","columnRef","backdropRef","onRowFocusAnimate","onEnter","find","c","states","has","item","href","onEscape","document","getElementsByTagName","focus","entityActions","onEnterTrailer","_$createComponent","Show","when","View","onUp","ContentBlock","content","heroContent","Row","ref","r$","_ref$","scroll","gap","onDown","Button","autofocus","Column","_ref$2","style","styles","zIndex","_$memo","recommendations","credits","Text","skipFocus","RowTitle","TileRow","onFocus","items","_ref$3","transition"],"mappings":"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"}
{"version":3,"file":"Entity-legacy-CTGaFRHn.js","sources":["../../node_modules/.pnpm/@lightningtv+solid-ui@0.21.0_@lightningtv+solid@1.4.0_@lightningjs+renderer@1.0.1_solid-js@1.8.19__solid-js@1.8.19/node_modules/@lightningtv/solid-ui/components/Button/Button.tsx","../../src/api/providers/entity.js","../../src/pages/Entity.tsx"],"sourcesContent":["/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { type Component } from 'solid-js';\nimport { View, Text } from '@lightningtv/solid';\nimport styles from './Button.styles.js';\nimport type { ButtonContainerProps, ButtonProps } from './Button.types.js';\n\nconst Button: Component<ButtonProps> = props => {\n  return (\n    <ButtonContainer\n      {...props}\n      color={props.backgroundColor}\n      itemSpacing={props.contentSpacing}\n      alignItems=\"center\"\n      forwardStates\n    >\n      <Text\n        color={props.textColor}\n        contain={props.contain ?? 'width'}\n        textAlign={props.textAlign}\n        style={[\n          styles.Text.tones[props.tone ?? styles.tone], //\n          styles.Text.base\n        ]}\n      >\n        {props.children}\n      </Text>\n    </ButtonContainer>\n  );\n};\n\nconst ButtonContainer: Component<ButtonContainerProps> = props => {\n  return (\n    <View\n      {...props}\n      color={props.backgroundColor}\n      justifyContent={props.justify}\n      itemSpacing={props.contentSpacing}\n      // @ts-expect-error TODO type needs to be fixed in framework\n      style={[\n        props.style, //\n        styles.Container.tones?.[props.tone ?? styles.tone],\n        styles.Container.base\n      ]}\n      forwardStates\n    />\n  );\n};\n\nexport {\n  Button as default, //\n  ButtonContainer,\n  type ButtonProps\n};\n","import api, { getImageUrl } from \"..\";\nimport { convertItemsToTiles } from \"../formatters/ItemFormatter\";\n\nexport function minutesToHMM(minutes) {\n  const hours = Math.floor(minutes / 60);\n  const remainingMinutes = minutes % 60;\n  return (\n    hours + \"h \" + (remainingMinutes < 10 ? \"0\" : \"\") + remainingMinutes + \"min\"\n  );\n}\n\nfunction formatDate(dateString) {\n  const parts = dateString.split(\"-\");\n  return parts[1] + \"/\" + parts[2] + \"/\" + parts[0];\n}\n\nfunction justYear(dateString) {\n  const parts = dateString.split(\"-\");\n  return parts[0];\n}\n\nexport function getRecommendations({ type, id }) {\n  return api.get(`/${type}/${id}/recommendations`).then(({ results }) => {\n    if (results.length) {\n      return convertItemsToTiles(results.slice(0, 7));\n    }\n    return api\n      .get(`/trending/${type}/week?page=1`)\n      .then(({ results }) => convertItemsToTiles(results.slice(0, 7)));\n  });\n}\n\nexport function getCredits({ type, id }) {\n  return api\n    .get(`/${type}/${id}/credits`)\n    .then(({ cast }) => convertItemsToTiles(cast.slice(0, 7)));\n}\n\nexport function getInfo({ type, id }) {\n  let rt =\n    type === \"movie\"\n      ? {\n          rtCrit: 86,\n          rtFan: 92,\n        }\n      : {};\n\n  return api.get(`/${type}/${id}`).then((data) => ({\n    backgroundImage: getImageUrl(data.backdrop_path, \"w1280\"),\n    heroContent: {\n      title: data.title || data.name,\n      description: data.overview,\n      badges: [\"HD\", \"CC\"],\n      voteAverage: data.vote_average,\n      voteCount: data.vote_count,\n      metaText:\n        type === \"movie\"\n          ? minutesToHMM(data.runtime) + \"   \" + formatDate(data.release_date)\n          : `${justYear(data.first_air_date)} - ${justYear(data.last_air_date)}`,\n      reviews: rt,\n    },\n    ...data,\n  }));\n}\n","import {\n  ElementNode,\n  Text,\n  View,\n  Show,\n  hexColor,\n  setActiveElement,\n} from \"@lightningtv/solid\";\nimport { Column, Button, Row } from \"@lightningtv/solid-ui\";\nimport { useParams } from \"@solidjs/router\";\nimport { createEffect, createResource, on, createSignal } from \"solid-js\";\nimport { TileRow } from \"../components\";\nimport { setGlobalBackground } from \"../state\";\nimport ContentBlock from \"../components/ContentBlock\";\nimport { useNavigate } from \"@solidjs/router\";\nimport styles from \"../styles\";\nimport * as provider from \"../api/providers/entity\";\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\nimport type { Tile } from \"../api/formatters/ItemFormatter\";\nimport { playVideo, closeVideo } from \"../video\";\n\nconst Entity = () => {\n  const params = useParams();\n  const navigate = useNavigate();\n\n  const [data] = createResource(() => ({ ...params }), provider.getInfo);\n  const [credits] = createResource<any, Tile[]>(\n    () => ({ ...params }),\n    provider.getCredits\n  );\n  const [recommendations] = createResource<any, Tile[]>(\n    () => ({ ...params }),\n    provider.getRecommendations\n  );\n  const [backdropAlpha, setBackdropAlpha] = createSignal(0);\n\n  createEffect(\n    on(\n      data,\n      (data) => {\n        setGlobalBackground(data.backgroundImage);\n      },\n      { defer: true }\n    )\n  );\n\n  const columnY = 640;\n\n  const Backdrop = {\n    color: \"#000000\",\n    alpha: 0,\n    width: 1900,\n    height: 890,\n    x: -160,\n    y: columnY,\n    borderRadius: 30,\n  };\n\n  function onRowFocus(this: ElementNode) {\n    this.children[this.selected || 0].setFocus();\n    columnRef.y = columnY;\n    backdropRef.y = columnY;\n    backdropRef.alpha = 0;\n  }\n\n  function onRowFocusAnimate(this: ElementNode) {\n    this.children[this.selected || 0].setFocus();\n    columnRef.y = 200;\n    backdropRef.y = 160;\n    backdropRef.alpha = 0.9;\n  }\n\n  function onEnter(this: ElementNode) {\n    let entity = this.children.find((c) => c.states!.has(\"focus\"));\n    assertTruthy(entity && entity.href);\n    navigate(entity.href);\n  }\n\n  function onEscape() {\n    closeVideo();\n    // Set focus back to lightning app\n    document.getElementsByTagName(\"canvas\")[0].focus();\n    entityActions.setFocus();\n    setBackdropAlpha(0);\n  }\n\n  function onEnterTrailer() {\n    const video = playVideo();\n    setActiveElement(video);\n    setBackdropAlpha(0.9);\n  }\n\n  let columnRef, backdropRef, entityActions;\n\n  return (\n    <Show when={data()} keyed>\n      <View x={170} onUp={() => entityActions.setFocus()} onEscape={onEscape}>\n        <ContentBlock y={260} content={data().heroContent}></ContentBlock>\n        <Row\n          ref={entityActions}\n          y={500}\n          scroll=\"none\"\n          height={90}\n          width={640}\n          gap={40}\n          onDown={() => columnRef.setFocus()}\n          onEnter={onEnterTrailer}\n        >\n          <Button width={300} autofocus>\n            Play\n          </Button>\n          <Button width={300}>Resume</Button>\n        </Row>\n\n        <Column\n          ref={columnRef}\n          x={0}\n          y={columnY}\n          style={styles.Column}\n          height={880}\n          scroll=\"none\"\n          zIndex={5}\n        >\n          <Show when={recommendations() && credits()}>\n            <Text skipFocus style={styles.RowTitle}>\n              Recommendations\n            </Text>\n            <TileRow\n              onFocus={onRowFocus}\n              onEnter={onEnter}\n              items={recommendations()}\n              width={1620}\n            />\n            <Text skipFocus style={styles.RowTitle}>\n              Cast and Crew\n            </Text>\n            <TileRow\n              onFocus={onRowFocusAnimate}\n              onEnter={onEnter}\n              items={credits()}\n              width={1620}\n            />\n          </Show>\n        </Column>\n        <View\n          ref={backdropRef}\n          style={Backdrop}\n          transition={{ alpha: true, y: true }}\n        />\n      </View>\n      <View\n        alpha={backdropAlpha()}\n        color={\"#000000\"}\n        skipFocus\n        zIndex={200}\n        transition={{ alpha: true }}\n      />\n    </Show>\n  );\n};\n\nexport default Entity;\n"],"names":["Button","props","_$createComponent","ButtonContainer","_$mergeProps","color","backgroundColor","itemSpacing","contentSpacing","alignItems","forwardStates","children","Text","textColor","contain","_props$contain","textAlign","style","_props$tone","styles","tones","tone","base","View","justifyContent","justify","_styles$Container$ton","_props$tone2","Container","justYear","dateString","split","getRecommendations","type","id","api","get","then","results","length","convertItemsToTiles","slice","getCredits","cast","getInfo","rt","rtCrit","rtFan","data","_objectSpread","backgroundImage","getImageUrl","backdrop_path","heroContent","title","name","description","overview","badges","voteAverage","vote_average","voteCount","vote_count","metaText","minutes","runtime","remainingMinutes","Math","floor","minutesToHMM","release_date","parts","first_air_date","last_air_date","reviews","Entity","params","useParams","navigate","useNavigate","_slicedToArray","createResource","provider","credits","recommendations","_createSignal2","createSignal","backdropAlpha","setBackdropAlpha","on","setGlobalBackground","defer","columnRef","backdropRef","entityActions","columnY","Backdrop","alpha","width","height","x","y","borderRadius","onRowFocus","this","selected","setFocus","onRowFocusAnimate","onEnter","entity","find","c","states","has","href","onEscape","closeVideo","document","getElementsByTagName","focus","onEnterTrailer","video","playVideo","setActiveElement","Show","when","keyed","onUp","ContentBlock","content","Row","ref","r$","scroll","gap","onDown","autofocus","Column","zIndex","_$memo","skipFocus","RowTitle","TileRow","onFocus","items","transition"],"mappings":"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","x_google_ignoreList":[0]}
var oe=Object.defineProperty;var ce=(n,t,e)=>t in n?oe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(ce(n,typeof t!="symbol"?t+"":t,e),e);function he(n,t){const e={};console.log(e),console.log(n);const r=n.getContext("webgl")||n.getContext("experimental-webgl",e);if(!r)throw new Error("Unable to create WebGL context");return t?new Proxy(r,{get(s,i){const o=s[i];return typeof o=="function"?(t.increment(String(i)),o.bind(s)):o}}):r}function m(n,t){if(!ue()&&!n)throw new Error(t||"Assertion failed")}function De(n,t,e){const r=Math.trunc(n>>>24),s=Math.trunc(n>>>16&255),i=Math.trunc(n>>>8&255),o=Math.trunc(n&255),c=Math.trunc(t>>>24),h=Math.trunc(t>>>16&255),u=Math.trunc(t>>>8&255),d=Math.trunc(t&255),f=Math.round(c*e+r*(1-e)),T=Math.round(h*e+s*(1-e)),_=Math.round(u*e+i*(1-e)),x=Math.round(d*e+o*(1-e));return(f<<24|T<<16|_<<8|x)>>>0}function Ge(n,t){const e=n>>>24,r=n>>>16&255,s=n>>>8&255,i=Math.trunc((n&255)*t);return(e<<24|r<<16|s<<8|i)>>>0}function Oe(n,t,e=!1){const r=(n&255)/255*t,s=Math.trunc((n>>>24)*r),i=Math.trunc((n>>>16&255)*r),o=Math.trunc((n>>>8&255)*r),c=Math.trunc(r*255);return e?(c<<24|o<<16|i<<8|s)>>>0:(s<<24|i<<16|o<<8|c)>>>0}function v(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function ue(){return{BASE_URL:"/solid-demo-app/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,LEGACY:!1}&&!0}class J{constructor(){a(this,"eventListeners",{})}on(t,e){let r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){const r=this.eventListeners[t];if(!r)return;if(!e){delete this.eventListeners[t];return}const s=r.indexOf(e);s>=0&&r.splice(s,1)}once(t,e){const r=(s,i)=>{this.off(t,r),e(s,i)};this.on(t,r)}emit(t,e){const r=this.eventListeners[t];r&&[...r].forEach(s=>{s(this,e)})}removeAllListeners(){this.eventListeners={}}}class le{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function Z(n,t,e){const r=n.createShader(t);if(!r)throw new Error;if(n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS))return r;console.log(n.getShaderInfoLog(r)),n.deleteShader(r)}function fe(n,t,e){const r=n.createProgram();if(!r)throw new Error;if(n.attachShader(r,t),n.attachShader(r,e),n.linkProgram(r),n.getProgramParameter(r,n.LINK_STATUS))return r;console.log(n.getProgramInfoLog(r)),n.deleteProgram(r)}function de(n){return self.WebGL2RenderingContext&&n instanceof self.WebGL2RenderingContext}class W extends le{constructor(e){super();a(this,"boundBufferCollection",null);a(this,"buffersBound",!1);a(this,"program");a(this,"vao");a(this,"renderer");a(this,"glw");a(this,"attributeBuffers");a(this,"attributeLocations");a(this,"attributeNames");a(this,"uniformLocations");a(this,"uniformTypes");a(this,"supportsIndexedTextures");const r=this.renderer=e.renderer,s=this.glw=this.renderer.glw;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const i=s.isWebGl2(),o=i&&e.webgl2Extensions||!i&&e.webgl1Extensions||[],c=i?"2.0":"1.0";o.forEach(E=>{if(!s.getExtension(E))throw new Error('Shader "'.concat(this.constructor.name,'" requires extension "').concat(E,'" for WebGL ').concat(c," but wasn't found"))});const h=e.shaderSources||this.constructor.shaderSources;if(h)i&&(h!=null&&h.webGl2)&&(h.fragment=h.webGl2.fragment,h.vertex=h.webGl2.vertex,delete h.webGl2);else throw new Error('Shader "'.concat(this.constructor.name,'" is missing shaderSources.'));const u=r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,d=h.vertex instanceof Function?h.vertex(u):h.vertex,f=h.fragment instanceof Function?h.fragment(u):h.fragment,T=Z(s,s.VERTEX_SHADER,d),_=Z(s,s.FRAGMENT_SHADER,f);if(!T||!_)throw new Error;const x=fe(s,T,_);if(!x)throw new Error;if(this.program=x,i){const E=s.createVertexArray();if(!E)throw new Error;this.vao=E,s.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(E=>{const R=s.getAttribLocation(this.program,E);if(R<0)throw new Error("".concat(this.constructor.name,': Vertex shader must have an attribute "').concat(E,'"!'));const A=s.createBuffer();if(!A)throw new Error("".concat(this.constructor.name,': Could not create buffer for attribute "').concat(E,'"'));this.attributeLocations[E]=R,this.attributeBuffers[E]=A,this.attributeNames.push(E)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(E=>{const R=s.getUniformLocation(this.program,E.name);if(this.uniformTypes[E.name]=E.uniform,!R){console.warn('Shader "'.concat(this.constructor.name,'" could not get uniform location for "').concat(E.name,'"'));return}this.uniformLocations[E.name]=R})}bindBufferAttribute(e,r,s){const{glw:i}=this;i.enableVertexAttribArray(e),i.vertexAttribPointer(r,e,s.size,s.type,s.normalized,s.stride,s.offset)}disableAttribute(e){this.glw.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,r){return!1}bindRenderOp(e,r){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{glw:s}=e;if(this.setUniform("u_resolution",[s.canvas.width,s.canvas.height]),this.setUniform("u_pixelRatio",e.options.pixelRatio),r){if(v(r,"$dimensions")){let i=r.$dimensions;i||(i=e.dimensions),this.setUniform("u_dimensions",[i.width,i.height])}if(v(r,"$alpha")){let i=r.$alpha;i||(i=e.alpha),this.setUniform("u_alpha",i)}this.bindProps(r)}}setUniform(e,...r){this.glw.setUniform(this.uniformTypes[e],this.uniformLocations[e],...r)}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const r in this.attributeLocations){const s=e.getBuffer(r),i=e.getAttributeInfo(r);m(s,'Buffer for "'.concat(r,'" not found')),m(i),this.bindBufferAttribute(this.attributeLocations[r],s,i)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.glw.useProgram(this.program),this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}a(W,"shaderSources");class Y extends J{constructor(e){super();a(this,"txManager");a(this,"dimensions",null);a(this,"error",null);a(this,"state","freed");a(this,"renderableOwners",new Set);this.txManager=e}setRenderableOwner(e,r){r?this.renderableOwners.add(e):this.renderableOwners.delete(e)}get renderable(){return this.renderableOwners.size>0}setState(e,...r){if(this.state!==e){if(this.state=e,e==="loaded"){const s=r;this.dimensions=s[0]}else if(e==="failed"){const s=r;this.error=s[0]}this.emit(e,...r)}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}const Ee=n=>{const t=n>>>24,e=n>>>16&255,r=n>>>8&255,s=n&255;return[t/255,e/255,r/255,s/255]};function Xe(n){return(n&255)/255}function Fe(n){const t=Math.floor(n[0]*255),e=Math.floor(n[1]*255),r=Math.floor(n[2]*255),s=Math.floor(n[3]*255);return"rgba(".concat(t,",").concat(e,",").concat(r,",").concat(s.toFixed(4),")")}function Q(n,t,e,r,s){return s?(s.x1=n,s.y1=t,s.x2=e,s.y2=r,s):{x1:n,y1:t,x2:e,y2:r}}function ve(n,t,e){const r=Q(Math.max(n.x1,t.x1),Math.max(n.y1,t.y1),Math.min(n.x2,t.x2),Math.min(n.y2,t.y2),e);return r.x1<r.x2&&r.y1<r.y2?r:Q(0,0,0,0,r)}function We(n,t){return n.x1<t.x2&&n.x2>t.x1&&n.y1<t.y2&&n.y2>t.y1}function Ve(n,t){return t?(t.x=n.x1,t.y=n.y1,t.width=n.x2-n.x1,t.height=n.y2-n.y1,t):{x:n.x1,y:n.y1,width:n.x2-n.x1,height:n.y2-n.y1}}function He(n,t,e){const r=Math.max(n.x,t.x),s=Math.max(n.y,t.y),i=Math.min(n.x+n.width,t.x+t.width)-r,o=Math.min(n.y+n.height,t.y+t.height)-s;return i>0&&o>0?e?(e.x=r,e.y=s,e.width=i,e.height=o,e):{x:r,y:s,width:i,height:o}:e?(e.x=0,e.y=0,e.width=0,e.height=0,e):{x:0,y:0,width:0,height:0}}function Ye(n,t){return t?(t.x=n.x,t.y=n.y,t.width=n.width,t.height=n.height,t):{x:n.x,y:n.y,width:n.width,height:n.height}}function Te(n,t){return n===t?!0:n===null||t===null?!1:n.x===t.x&&n.y===t.y&&n.width===t.width&&n.height===t.height}function ke(n,t){return n.x1<=t.x2&&n.y1<=t.y2&&n.x2>=t.x1&&n.y2>=t.y1}function $e(n){return n.x1<n.x2&&n.y1<n.y2}class ee extends J{constructor(e,r){super();a(this,"fontFamily");a(this,"descriptors");a(this,"loaded",!1);this.fontFamily=e,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...r}}static convertToCssFontFaceDescriptors(e){return{style:e.style,weight:typeof e.weight=="number"?"".concat(e.weight):e.weight,stretch:e.stretch,unicodeRange:e.unicodeRange,variant:e.variant,featureSettings:e.featureSettings,display:e.display}}}class ze extends ee{constructor(e,r,s){super(e,r);a(this,"fontFace");a(this,"fontUrl");const i=s.replace(/\(|\)/g,""),o=this.descriptors,c={style:o.style,weight:typeof o.weight=="number"?"".concat(o.weight):o.weight,stretch:o.stretch,unicodeRange:o.unicodeRange,variant:o.variant,featureSettings:o.featureSettings,display:o.display},h=new FontFace(e,"url(".concat(i,")"),c);h.load().then(()=>{this.loaded=!0,this.emit("loaded")}).catch(console.error),this.fontFace=h,this.fontUrl=s}}class _e{constructor(t,e){a(this,"memManager");a(this,"textureSource");this.memManager=t,this.textureSource=e}}class xe{constructor(t){a(this,"stage");this.stage=t}}class Re{}class Ae extends Re{constructor(e,r,s,i,o,c,h,u,d,f){super();a(this,"glw");a(this,"options");a(this,"buffers");a(this,"shader");a(this,"shaderProps");a(this,"alpha");a(this,"clippingRect");a(this,"dimensions");a(this,"bufferIdx");a(this,"zIndex");a(this,"length",0);a(this,"numQuads",0);a(this,"textures",[]);a(this,"maxTextures");this.glw=e,this.options=r,this.buffers=s,this.shader=i,this.shaderProps=o,this.alpha=c,this.clippingRect=h,this.dimensions=u,this.bufferIdx=d,this.zIndex=f,this.maxTextures=i.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:r,maxTextures:s}=this,i=r.findIndex(c=>c===e);if(i!==-1)return i;const o=r.length;return o>=s?4294967295:(this.textures.push(e),o)}draw(){const{glw:e,shader:r,shaderProps:s,options:i}=this,{shManager:o}=i;o.useShader(r),r.bindRenderOp(this,s);const c=this.bufferIdx/24*6*2;if(this.clippingRect.valid){const{x:h,y:u,width:d,height:f}=this.clippingRect,T=i.pixelRatio,_=i.canvas.height,x=Math.round(h*T),E=Math.round(d*T),R=Math.round(f*T),A=Math.round(_-R-u*T);e.setScissorTest(!0),e.scissor(x,A,E,R)}else e.setScissorTest(!1);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,c)}}function ge(n){const t={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(t).forEach(r=>{t[r]=n.getParameter(n[r])}),t}function me(n){const t={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(t).forEach(r=>{t[r]=n.getExtension(r)}),t}function pe(n,t){const e=~~(t/80),r=new Uint16Array(e*6);for(let i=0,o=0;i<e;i+=6,o+=4)r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+2,r[i+4]=o+1,r[i+5]=o+3;const s=n.createBuffer();n.elementArrayBufferData(s,r,n.STATIC_DRAW)}function Ie(n){return n!==null&&typeof n=="object"&&n.constructor&&n.constructor.name==="HTMLImageElement"}function Se(n,t){var e=0,r,s;t=t||{};function i(){var o=r,c=arguments.length,h,u;e:for(;o;){if(o.args.length!==arguments.length){o=o.next;continue}for(u=0;u<c;u++)if(o.args[u]!==arguments[u]){o=o.next;continue e}return o!==r&&(o===s&&(s=o.prev),o.prev.next=o.next,o.next&&(o.next.prev=o.prev),o.next=r,o.prev=null,r.prev=o,r=o),o.val}for(h=new Array(c),u=0;u<c;u++)h[u]=arguments[u];return o={args:h,val:n.apply(null,h)},r?(r.prev=o,o.next=r):s=o,e===t.maxSize?(s=s.prev,s.next=null):e++,r=o,o.val}return i.clear=function(){r=null,s=null,e=0},i}const j=n=>n&&!(n&n-1),g=(n,t,e,r)=>{const s=3*n,i=3*(e-n)-s,o=1-s-i,c=3*t,h=3*(r-t)-c,u=1-c-h;return function(d){if(d>=1)return 1;if(d<=0)return 0;let f=.5,T,_,x;for(let A=0;A<20;A++){if(T=f*(f*(f*o+i)+s),x=d-T,x>-1e-8&&x<1e-8)return f*(f*(f*u+h)+c);if(_=f*(f*(3*o)+2*i)+s,_>1e-10&&_<1e-10)break;f+=x/_}let E=0,R=1;for(let A=0;A<20;A++){if(f=.5*(E+R),T=f*(f*(f*o+i)+s),x=d-T,x>-1e-8&&x<1e-8)return f*(f*(f*u+h)+c);x<0?R=f:E=f}}},qe=Se(n=>{switch(n){case"linear":return function(e){return e};case"ease":return g(.25,.1,.25,1);case"ease-in":return g(.42,0,1,1);case"ease-out":return g(0,0,.58,1);case"ease-in-out":return g(.42,0,.58,1);case"ease-in-sine":return g(.12,0,.39,0);case"ease-out-sine":return g(.12,0,.39,0);case"ease-in-out-sine":return g(.37,0,.63,1);case"ease-in-cubic":return g(.32,0,.67,0);case"ease-out-cubic":return g(.33,1,.68,1);case"ease-in-out-cubic":return g(.65,0,.35,1);case"ease-in-circ":return g(.55,0,1,.45);case"ease-out-circ":return g(0,.55,.45,1);case"ease-in-out-circ":return g(.85,0,.15,1);case"ease-in-back":return g(.36,0,.66,-.56);case"ease-out-back":return g(.34,1.56,.64,1);case"ease-in-out-back":return g(.68,-.6,.32,1.6);case"step-start":return function(){return 1};case"step-end":return function(e){return e===1?1:0};default:const t="cubic-bezier(";if(n&&n.indexOf(t)===0){const e=n.substr(t.length,n.length-t.length-1).split(",");if(e.length!==4)return console.warn("Unknown timing function: "+n),function(c){return c};const r=parseFloat(e[0]||"0.42"),s=parseFloat(e[1]||"0"),i=parseFloat(e[2]||"1"),o=parseFloat(e[3]||"1");return isNaN(r)||isNaN(s)||isNaN(i)||isNaN(o)?(console.warn(" Unknown timing function: "+n),function(c){return c}):g(r,s,i,o)}else return console.warn("Unknown timing function: "+n),function(e){return e}}});Math.hypot||(Math.hypot=(...n)=>{let t=0,e=n.length;for(;e--;)t+=n[e]*n[e];return Math.sqrt(t)});const B=new Uint8Array([0,0,0,0]);class V extends _e{constructor(e,r,s){super(r,s);a(this,"glw");a(this,"_nativeCtxTexture",null);a(this,"_state","freed");a(this,"_w",0);a(this,"_h",0);this.glw=e}get ctxTexture(){return this._state==="freed"&&this.load(),m(this._nativeCtxTexture),this._nativeCtxTexture}get renderable(){return this.textureSource.renderable}get w(){return this._w}get h(){return this._h}load(){this._state==="loading"||this._state==="loaded"||(this._state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this.onLoadRequest().then(({width:e,height:r})=>{this._state!=="freed"&&(this._state="loaded",this._w=e,this._h=r,this.textureSource.setState("loaded",{width:e,height:r}))}).catch(e=>{this._state="failed",this.textureSource.setState("failed",e),console.error(e)}))}async onLoadRequest(){var c,h;const{glw:e,memManager:r}=this;e.activeTexture(0),e.bindTexture(this._nativeCtxTexture),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,B),r.setTextureMemUse(this,B.byteLength);const s=await((c=this.textureSource)==null?void 0:c.getTextureData());if(!this._nativeCtxTexture)return m(this._state==="freed"),{width:0,height:0};let i=0,o=0;if(m(this._nativeCtxTexture),e.activeTexture(0),s.data instanceof ImageBitmap||s.data instanceof ImageData||Ie(s.data)){const u=s.data;i=u.width,o=u.height,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!s.premultiplyAlpha),e.texImage2D(0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),r.setTextureMemUse(this,i*o*4),(e.isWebGl2()||j(i)&&j(o))&&e.generateMipmap()}else if(s.data===null)i=0,o=0,e.bindTexture(this._nativeCtxTexture),e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,B),r.setTextureMemUse(this,B.byteLength);else if("mipmaps"in s.data&&s.data.mipmaps){const{mipmaps:u,width:d=0,height:f=0,type:T,glInternalFormat:_}=s.data,x=T==="ktx"?new DataView((h=u[0])!=null?h:new ArrayBuffer(0)):u[0];e.bindTexture(this._nativeCtxTexture),e.compressedTexImage2D(0,_,d,f,0,x),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),r.setTextureMemUse(this,x.byteLength)}else console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",s);return{width:i,height:o}}free(){if(this._state==="freed"||(this._state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,!this._nativeCtxTexture))return;const{glw:e,memManager:r}=this;e.deleteTexture(this._nativeCtxTexture),r.setTextureMemUse(this,0),this._nativeCtxTexture=null}createNativeCtxTexture(){const{glw:e}=this,r=e.createTexture();if(!r)throw new Error("Could not create WebGL Texture");return r}}const P=class P extends Y{constructor(e,r){super(e);a(this,"props");this.props=P.resolveDefaults(r||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureData(){const e=new Uint32Array([this.color]),r=new Uint8ClampedArray(e.buffer);return{data:new ImageData(r,1,1),premultiplyAlpha:!0}}static makeCacheKey(e){const r=P.resolveDefaults(e);return"ColorTexture,".concat(r.color)}static resolveDefaults(e){return{color:e.color||4294967295}}};a(P,"z$__type__Props");let H=P;const D=class D extends Y{constructor(e,r){super(e);a(this,"props");a(this,"parentTexture");a(this,"onParentTxLoaded",()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})});a(this,"onParentTxFailed",(e,r)=>{this.setState("failed",r)});this.parentTexture=this.txManager.loadTexture(r.texture.txType,r.texture.props,r.texture.options),this.props=D.resolveDefaults(r||{}),queueMicrotask(()=>{const s=this.parentTexture;s.state==="loaded"?this.onParentTxLoaded(s,s.dimensions):s.state==="failed"&&this.onParentTxFailed(s,s.error),s.on("loaded",this.onParentTxLoaded),s.on("failed",this.onParentTxFailed)})}async getTextureData(){return{data:this.props}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};a(D,"z$__type__Props");let C=D;class Me extends V{constructor(t,e,r){super(t,e,r)}async onLoadRequest(){var e,r;const t=await this.textureSource.getTextureData();return{width:((e=t.data)==null?void 0:e.width)||0,height:((r=t.data)==null?void 0:r.height)||0}}}class ye{constructor(t){a(this,"config");this.config=t}getBuffer(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.buffer}getAttributeInfo(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.attributes[t]}}class Ne{constructor(t){a(this,"gl");a(this,"activeTextureUnit",0);a(this,"texture2dUnits");a(this,"texture2dParams",new WeakMap);a(this,"scissorEnabled");a(this,"scissorX");a(this,"scissorY");a(this,"scissorWidth");a(this,"scissorHeight");a(this,"blendEnabled");a(this,"blendSrcRgb");a(this,"blendDstRgb");a(this,"blendSrcAlpha");a(this,"blendDstAlpha");a(this,"boundArrayBuffer");a(this,"boundElementArrayBuffer");a(this,"curProgram");a(this,"programUniforms",new WeakMap);a(this,"canvas");a(this,"MAX_RENDERBUFFER_SIZE");a(this,"MAX_TEXTURE_SIZE");a(this,"MAX_VIEWPORT_DIMS");a(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS");a(this,"MAX_TEXTURE_IMAGE_UNITS");a(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS");a(this,"MAX_VERTEX_ATTRIBS");a(this,"MAX_VARYING_VECTORS");a(this,"MAX_VERTEX_UNIFORM_VECTORS");a(this,"MAX_FRAGMENT_UNIFORM_VECTORS");a(this,"TEXTURE_MAG_FILTER");a(this,"TEXTURE_MIN_FILTER");a(this,"TEXTURE_WRAP_S");a(this,"TEXTURE_WRAP_T");a(this,"LINEAR");a(this,"CLAMP_TO_EDGE");a(this,"RGBA");a(this,"UNSIGNED_BYTE");a(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL");a(this,"FLOAT");a(this,"TRIANGLES");a(this,"UNSIGNED_SHORT");a(this,"ONE");a(this,"ONE_MINUS_SRC_ALPHA");a(this,"VERTEX_SHADER");a(this,"FRAGMENT_SHADER");a(this,"STATIC_DRAW");a(this,"COMPILE_STATUS");a(this,"LINK_STATUS");a(this,"DYNAMIC_DRAW");this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map((s,i)=>(this.activeTexture(i),t.getParameter(t.TEXTURE_BINDING_2D))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);const r=t.getParameter(t.SCISSOR_BOX);this.scissorX=r[0],this.scissorY=r[1],this.scissorWidth=r[2],this.scissorHeight=r[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW}isWebGl2(){return de(this.gl)}activeTexture(t){const{gl:e}=this;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){const{gl:e,activeTextureUnit:r,texture2dUnits:s}=this;s[r]!==t&&(s[r]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){const{activeTextureUnit:t,texture2dUnits:e}=this;return e[t]}texParameteri(t,e){const{gl:r,texture2dParams:s}=this,i=this._getActiveTexture();if(!i)throw new Error("No active texture");let o=s.get(i);o||(o={},s.set(i,o)),o[t]!==e&&(o[t]=e,r.texParameteri(r.TEXTURE_2D,t,e))}texImage2D(t,e,r,s,i,o,c,h){const{gl:u}=this;o?u.texImage2D(u.TEXTURE_2D,t,e,r,s,i,o,c,h):u.texImage2D(u.TEXTURE_2D,t,e,r,s,i)}compressedTexImage2D(t,e,r,s,i,o){const{gl:c}=this;c.compressedTexImage2D(c.TEXTURE_2D,t,e,r,s,i,o)}pixelStorei(t,e){const{gl:r}=this;r.pixelStorei(t,e)}generateMipmap(){const{gl:t}=this;t.generateMipmap(t.TEXTURE_2D)}createTexture(){const{gl:t}=this;return t.createTexture()}deleteTexture(t){const{gl:e}=this;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}viewport(t,e,r,s){const{gl:i}=this;i.viewport(t,e,r,s)}clearColor(t,e,r,s){const{gl:i}=this;i.clearColor(t,e,r,s)}setScissorTest(t){const{gl:e,scissorEnabled:r}=this;t!==r&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,r,s){const{gl:i,scissorX:o,scissorY:c,scissorWidth:h,scissorHeight:u}=this;(t!==o||e!==c||r!==h||s!==u)&&(i.scissor(t,e,r,s),this.scissorX=t,this.scissorY=e,this.scissorWidth=r,this.scissorHeight=s)}setBlend(t){const{gl:e,blendEnabled:r}=this;t!==r&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){const{gl:r,blendSrcRgb:s,blendDstRgb:i,blendSrcAlpha:o,blendDstAlpha:c}=this;(t!==s||e!==i||t!==o||e!==c)&&(r.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){const{gl:t}=this;return t.createBuffer()}clear(){const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,r){const{gl:s,boundArrayBuffer:i}=this;i!==t&&(s.bindBuffer(s.ARRAY_BUFFER,t),this.boundArrayBuffer=t),s.bufferData(s.ARRAY_BUFFER,e,r)}elementArrayBufferData(t,e,r){const{gl:s,boundElementArrayBuffer:i}=this;i!==t&&(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),s.bufferData(s.ELEMENT_ARRAY_BUFFER,e,r)}vertexAttribPointer(t,e,r,s,i,o,c){const{gl:h,boundArrayBuffer:u}=this;u!==t&&(h.bindBuffer(h.ARRAY_BUFFER,t),this.boundArrayBuffer=t),h.vertexAttribPointer(e,r,s,i,o,c)}useProgram(t){const{gl:e,curProgram:r}=this;r!==t&&(e.useProgram(t),this.curProgram=t)}setUniform(t,e,...r){const{gl:s,programUniforms:i}=this;let o=i.get(this.curProgram);o||(o=new Map,i.set(this.curProgram,o));const c=o.get(e);(!c||!Le(c,r))&&(o.set(e,r),s[t](e,...r))}getParameter(t){const{gl:e}=this;return e.getParameter(t)}drawElements(t,e,r,s){const{gl:i}=this;i.drawElements(t,e,r,s)}getExtension(t){const{gl:e}=this;return e.getExtension(t)}createVertexArray(){const{gl:t}=this;return m(t instanceof WebGL2RenderingContext),t.createVertexArray()}bindVertexArray(t){const{gl:e}=this;m(e instanceof WebGL2RenderingContext),e.bindVertexArray(t)}getAttribLocation(t,e){const{gl:r}=this;return r.getAttribLocation(t,e)}getUniformLocation(t,e){const{gl:r}=this;return r.getUniformLocation(t,e)}enableVertexAttribArray(t){const{gl:e}=this;e.enableVertexAttribArray(t)}disableVertexAttribArray(t){const{gl:e}=this;e.disableVertexAttribArray(t)}createShader(t){const{gl:e}=this;return e.createShader(t)}compileShader(t){const{gl:e}=this;e.compileShader(t)}attachShader(t,e){const{gl:r}=this;r.attachShader(t,e)}linkProgram(t){const{gl:e}=this;e.linkProgram(t)}deleteProgram(t){const{gl:e}=this;e.deleteProgram(t)}getShaderParameter(t,e){const{gl:r}=this;return r.getShaderParameter(t,e)}getShaderInfoLog(t){const{gl:e}=this;return e.getShaderInfoLog(t)}createProgram(){const{gl:t}=this;return t.createProgram()}getProgramParameter(t,e){const{gl:r}=this;return r.getProgramParameter(t,e)}getProgramInfoLog(t){const{gl:e}=this;return e.getProgramInfoLog(t)}shaderSource(t,e){const{gl:r}=this;r.shaderSource(t,e)}deleteShader(t){const{gl:e}=this;e.deleteShader(t)}}function Le(n,t){return n.length!==t.length?!1:n.every((e,r)=>Array.isArray(e)||e instanceof Float32Array?!1:e===t[r])}const Ue=24;class Pe extends xe{constructor(e){super(e.stage);a(this,"glw");a(this,"system");a(this,"txManager");a(this,"txMemManager");a(this,"shManager");a(this,"options");a(this,"quadBuffer",new ArrayBuffer(1024*1024*4));a(this,"fQuadBuffer",new Float32Array(this.quadBuffer));a(this,"uiQuadBuffer",new Uint32Array(this.quadBuffer));a(this,"renderOps",[]);a(this,"curBufferIdx",0);a(this,"curRenderOp",null);a(this,"renderables",[]);a(this,"defaultShader");a(this,"quadBufferCollection");a(this,"defaultTexture");const{canvas:r,clearColor:s,bufferMemory:i}=e;this.options=e,this.txManager=e.txManager,this.txMemManager=e.txMemManager,this.shManager=e.shManager,this.defaultTexture=new H(this.txManager),this.defaultTexture.once("loaded",()=>{this.stage.requestRender()});const o=he(r,e.contextSpy),c=this.glw=new Ne(o),h=Ee(s);c.viewport(0,0,r.width,r.height),c.clearColor(h[0],h[1],h[2],h[3]),c.setBlend(!0),c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),pe(c,i),this.system={parameters:ge(this.glw),extensions:me(this.glw)},this.shManager.renderer=this,this.defaultShader=this.shManager.loadShader("DefaultShader").shader;const u=c.createBuffer();m(u);const d=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new ye([{buffer:u,attributes:{a_position:{name:"a_position",size:2,type:c.FLOAT,normalized:!1,stride:d,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:c.FLOAT,normalized:!1,stride:d,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:c.UNSIGNED_BYTE,normalized:!0,stride:d,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:c.FLOAT,normalized:!1,stride:d,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){const{glw:e}=this;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,e.setScissorTest(!1),e.clear()}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof C?new Me(this.glw,this.txMemManager,e):new V(this.glw,this.txMemManager,e)}addQuad(e){var $,z;const{fQuadBuffer:r,uiQuadBuffer:s}=this,{width:i,height:o,colorTl:c,colorTr:h,colorBl:u,colorBr:d,textureOptions:f,shader:T,shaderProps:_,alpha:x,clippingRect:E,tx:R,ty:A,ta:G,tb:O,tc:X,td:F}=e;let{texture:I}=e;if(_&&v(_,"$dimensions")){const U=_.$dimensions;U.width=i,U.height=o}I=I!=null?I:this.defaultTexture,m(I instanceof Y,"Invalid texture type");let{curBufferIdx:l,curRenderOp:p}=this;const te={width:i,height:o},w=T||this.defaultShader;m(w instanceof W),p&&(p.shader!==w||!Te(p.clippingRect,E)||p.shader!==this.defaultShader&&(!_||!p.shader.canBatchShaderProps(p.shaderProps,_)))&&(p=null),m(w instanceof W),p||(this.newRenderOp(w,_,x,te,E,l),p=this.curRenderOp,m(p));const re=($=f==null?void 0:f.flipX)!=null?$:!1,se=(z=f==null?void 0:f.flipY)!=null?z:!1;let S=0,M=0,N=1,L=1;if(I instanceof C){const{x:U,y:b,width:ie,height:ae}=I.props,{width:q=0,height:K=0}=I.parentTexture.dimensions||{width:0,height:0};S=U/q,N=S+ie/q,M=b/K,L=M+ae/K,I=I.parentTexture}re&&([S,N]=[N,S]),se&&([M,L]=[L,M]);const{txManager:ne}=this.stage,k=ne.getCtxTexture(I);m(k instanceof V);const y=this.addTexture(k,l);if(p=this.curRenderOp,m(p),O!==0||X!==0)r[l++]=R,r[l++]=A,r[l++]=S,r[l++]=M,s[l++]=c,r[l++]=y,r[l++]=R+i*G,r[l++]=A+i*X,r[l++]=N,r[l++]=M,s[l++]=h,r[l++]=y,r[l++]=R+o*O,r[l++]=A+o*F,r[l++]=S,r[l++]=L,s[l++]=u,r[l++]=y,r[l++]=R+i*G+o*O,r[l++]=A+i*X+o*F,r[l++]=N,r[l++]=L,s[l++]=d,r[l++]=y;else{const U=R+i*G,b=A+o*F;r[l++]=R,r[l++]=A,r[l++]=S,r[l++]=M,s[l++]=c,r[l++]=y,r[l++]=U,r[l++]=A,r[l++]=N,r[l++]=M,s[l++]=h,r[l++]=y,r[l++]=R,r[l++]=b,r[l++]=S,r[l++]=L,s[l++]=u,r[l++]=y,r[l++]=U,r[l++]=b,r[l++]=N,r[l++]=L,s[l++]=d,r[l++]=y}p.length+=Ue,p.numQuads++,this.curBufferIdx=l}newRenderOp(e,r,s,i,o,c){const h=new Ae(this.glw,this.options,this.quadBufferCollection,e,r,s,o,i,c,0);this.curRenderOp=h,this.renderOps.push(h)}addTexture(e,r,s){const{curRenderOp:i}=this;m(i);const o=i.addTexture(e);if(o===4294967295){if(s)throw new Error("Unable to add texture to render op");const{shader:c,shaderProps:h,dimensions:u,clippingRect:d,alpha:f}=i;return this.newRenderOp(c,h,f,u,d,r),this.addTexture(e,r,!0)}return o}addRenderOp(e){this.renderOps.push(e),this.curRenderOp=null}render(e="screen"){var c;const{glw:r,quadBuffer:s}=this,i=new Float32Array(s,0,this.curBufferIdx),o=(c=this.quadBufferCollection.getBuffer("a_position"))!=null?c:null;r.arrayBufferData(o,i,r.STATIC_DRAW),this.renderOps.forEach((h,u)=>{h.draw()}),this.renderables=[]}}const we={LINE_FEED:10,CARRIAGE_RETURN:13,SPACE:32,TAB:9,ZERO_WIDTH_SPACE:8203,ZERO_WIDTH_NON_JOINER:8204,ZERO_WIDTH_JOINER:8205,LEFT_TO_RIGHT_MARK:8206,RIGHT_TO_LEFT_MARK:8207,LEFT_TO_RIGHT_EMBEDDING:8234,RIGHT_TO_LEFT_EMBEDDING:8235,POP_DIRECTIONAL_FORMATTING:8236,LEFT_TO_RIGHT_OVERRIDE:8237,RIGHT_TO_LEFT_OVERRIDE:8238,LINE_SEPARATOR:8232,PARAGRAPH_SEPARATOR:8233,OBJECT_REPLACEMENT_CHARACTER:65532,REPLACEMENT_CHARACTER:65533,ZERO_WIDTH_NO_BREAK_SPACE:65279,LEFT_TO_RIGHT_ISOLATE:8294,RIGHT_TO_LEFT_ISOLATE:8295,FIRST_STRONG_ISOLATE:8296,POP_DIRECTIONAL_ISOLATE:8297,INHIBIT_SYMMETRIC_SWAPPING:8298,ACTIVATE_SYMMETRIC_SWAPPING:8299,INHIBIT_ARABIC_FORM_SHAPING:8300,ACTIVATE_ARABIC_FORM_SHAPING:8301,NATIONAL_DIGIT_SHAPES:8302,NOMINAL_DIGIT_SHAPES:8303,LEFT_TO_RIGHT_BOUNDARY:8206,RIGHT_TO_LEFT_BOUNDARY:8207};class be{}class Be extends be{constructor(e,r){super();a(this,"data");a(this,"glyphMap");a(this,"kernings");this.data=e,this.glyphMap=r;const s=this.kernings={};e.kernings.forEach(i=>{const o=i.second,c=s[o]=s[o]||{};c[i.first]=i.amount}),this.kernings=s}*shapeText(e,r){var o;let s,i;for(;(s=r.peek())&&!s.done;){const c=s.value,h=this.glyphMap.get(c);if(r.next(),h!==void 0){const u=i!==void 0?(((o=this.kernings[h.id])==null?void 0:o[i])||0)+e.letterSpacing:0;i=h.id,yield{mapped:!0,glyphId:h.id,codepoint:c,cluster:r.lastIndex,xAdvance:h.xadvance+u,yAdvance:0,xOffset:h.xoffset+u,yOffset:h.yoffset,xBearing:0,yBearing:0,width:h.width,height:h.height}}else c===we.LINE_FEED&&(i=void 0),yield{mapped:!1,codepoint:c,cluster:r.lastIndex}}}}class Ke extends ee{constructor(e,r,s,i,o,c){super(e,r);a(this,"type");a(this,"texture");a(this,"maxCharHeight",0);a(this,"data");a(this,"shaper");a(this,"glyphMap",new Map);this.type=s;const h=i.renderer;m(h instanceof Pe,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=i.txManager.loadTexture("ImageTexture",{src:o,premultiplyAlpha:!1},{preload:!0}),this.texture.on("loaded",()=>{this.checkLoaded()}),fetch(c).then(async u=>{this.data=await u.json();let d=0;this.data.chars.forEach(f=>{this.glyphMap.set(f.id,f);const T=f.yoffset+f.height;T>d&&(d=T)}),this.maxCharHeight=d,this.shaper=new Be(this.data,this.glyphMap),this.checkLoaded()}).catch(console.error)}getAtlasEntry(e){const r=this.glyphMap.get(e);if(r===void 0)throw new Error("Glyph ".concat(e," not found in font ").concat(this.fontFamily));return{x:r.x,y:r.y,width:r.width,height:r.height}}checkLoaded(){this.loaded||this.texture.state==="loaded"&&this.data&&(this.loaded=!0,this.emit("loaded"))}}class Ze{}export{ye as B,Ze as C,J as E,Ke as S,Y as T,ze as W,m as a,Ee as b,Q as c,ve as d,He as e,Xe as f,Fe as g,W as h,ue as i,Se as j,$e as k,We as l,Oe as m,Ve as n,Ye as o,Ae as p,Ge as q,qe as r,De as s,ke as t,H as u,C as v,Pe as w};
//# sourceMappingURL=CoreExtension-DYFa4xwG.js.map

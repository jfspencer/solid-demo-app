!function(){function t(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t=function(){return r};var e,r={},i=Object.prototype,n=i.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",h=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(e){d=function(t,e,r){return t[e]=r}}function c(t,e,r,i){var n=e&&e.prototype instanceof T?e:T,a=Object.create(n.prototype),o=new N(i||[]);return s(a,"_invoke",{value:S(t,r,o)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=c;var f="suspendedStart",v="suspendedYield",g="executing",p="completed",E={};function T(){}function x(){}function _(){}var m={};d(m,o,(function(){return this}));var R=Object.getPrototypeOf,A=R&&R(R(U([])));A&&A!==i&&n.call(A,o)&&(m=A);var b=_.prototype=T.prototype=Object.create(m);function y(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(i,s,a,o){var h=l(t[i],t,s);if("throw"!==h.type){var u=h.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,a,o)}),(function(t){r("throw",t,a,o)})):e.resolve(d).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,o)}))}o(h.arg)}var i;s(this,"_invoke",{value:function(t,n){function s(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(s,s):s()}})}function S(t,r,i){var n=f;return function(s,a){if(n===g)throw Error("Generator is already running");if(n===p){if("throw"===s)throw a;return{value:e,done:!0}}for(i.method=s,i.arg=a;;){var o=i.delegate;if(o){var h=M(o,i);if(h){if(h===E)continue;return h}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===f)throw n=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=g;var u=l(t,r,i);if("normal"===u.type){if(n=i.done?p:v,u.arg===E)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(n=p,i.method="throw",i.arg=u.arg)}}}function M(t,r){var i=r.method,n=t.iterator[i];if(n===e)return r.delegate=null,"throw"===i&&t.iterator.return&&(r.method="return",r.arg=e,M(t,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),E;var s=l(n,t.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,E;var a=s.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,E):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,E)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function U(t){if(t||""===t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(typeof t+" is not iterable")}return x.prototype=_,s(b,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:x,configurable:!0}),x.displayName=d(_,u,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,d(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},r.awrap=function(t){return{__await:t}},y(w.prototype),d(w.prototype,h,(function(){return this})),r.AsyncIterator=w,r.async=function(t,e,i,n,s){void 0===s&&(s=Promise);var a=new w(c(t,e,i,n),s);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(b),d(b,u,"Generator"),d(b,o,(function(){return this})),d(b,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},r.values=U,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(i,n){return o.type="throw",o.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var h=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(h&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(h){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=e,s?(this.method="next",this.next=s.finallyLoc,E):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),E},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),E}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;L(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:U(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),E}},r}function e(t,e,r,i,n,s,a){try{var o=t[s](a),h=o.value}catch(u){return void r(u)}o.done?e(h):Promise.resolve(h).then(i,n)}function r(t){return function(){var r=this,i=arguments;return new Promise((function(n,s){var a=t.apply(r,i);function o(t){e(a,n,s,o,h,"next",t)}function h(t){e(a,n,s,o,h,"throw",t)}o(void 0)}))}}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function n(t,e,r){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?i:i+"")in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}System.register([],(function(e,s){"use strict";return{execute:function(){function s(t,e){}function a(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(){return{BASE_URL:"/solid-demo-app/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,LEGACY:!0}&&!0}e({a:s,c:v,d:function(t,e,r){var i=v(Math.max(t.x1,e.x1),Math.max(t.y1,e.y1),Math.min(t.x2,e.x2),Math.min(t.y2,e.y2),r);if(i.x1<i.x2&&i.y1<i.y2)return i;return v(0,0,0,0,i)},e:function(t,e,r){var i=Math.max(t.x,e.x),n=Math.max(t.y,e.y),s=Math.min(t.x+t.width,e.x+e.width)-i,a=Math.min(t.y+t.height,e.y+e.height)-n;if(s>0&&a>0)return r?(r.x=i,r.y=n,r.width=s,r.height=a,r):{x:i,y:n,width:s,height:a};if(r)return r.x=0,r.y=0,r.width=0,r.height=0,r;return{x:0,y:0,width:0,height:0}},f:function(t){return(255&t)/255},g:function(t){var e=Math.floor(255*t[0]),r=Math.floor(255*t[1]),i=Math.floor(255*t[2]),n=Math.floor(255*t[3]);return`rgba(${e},${r},${i},${n.toFixed(4)})`},h:R,i:o,k:function(t){return t.x1<t.x2&&t.y1<t.y2},l:function(t,e){return t.x1<e.x2&&t.x2>e.x1&&t.y1<e.y2&&t.y2>e.y1},m:function(t,e,r=!1){var i=(255&t)/255*e,n=Math.trunc((t>>>24)*i),s=Math.trunc((t>>>16&255)*i),a=Math.trunc((t>>>8&255)*i),o=Math.trunc(255*i);if(r)return(o<<24|a<<16|s<<8|n)>>>0;return(n<<24|s<<16|a<<8|o)>>>0},n:function(t,e){if(e)return e.x=t.x1,e.y=t.y1,e.width=t.x2-t.x1,e.height=t.y2-t.y1,e;return{x:t.x1,y:t.y1,width:t.x2-t.x1,height:t.y2-t.y1}},o:function(t,e){if(e)return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e;return{x:t.x,y:t.y,width:t.width,height:t.height}},q:function(t,e){var r=t>>>24,i=t>>>16&255,n=t>>>8&255,s=Math.trunc((255&t)*e);return(r<<24|i<<16|n<<8|s)>>>0},s:function(t,e,r){var i=Math.trunc(t>>>24),n=Math.trunc(t>>>16&255),s=Math.trunc(t>>>8&255),a=Math.trunc(255&t),o=Math.trunc(e>>>24),h=Math.trunc(e>>>16&255),u=Math.trunc(e>>>8&255),d=Math.trunc(255&e),c=Math.round(o*r+i*(1-r)),l=Math.round(h*r+n*(1-r)),f=Math.round(u*r+s*(1-r)),v=Math.round(d*r+a*(1-r));return(c<<24|l<<16|f<<8|v)>>>0},t:function(t,e){return t.x1<=e.x2&&t.y1<=e.y2&&t.x2>=e.x1&&t.y2>=e.y1}});class h{constructor(){n(this,"eventListeners",{})}on(t,e){var r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){var r=this.eventListeners[t];if(r)if(e){var i=r.indexOf(e);i>=0&&r.splice(i,1)}else delete this.eventListeners[t]}once(t,e){var r=(i,n)=>{this.off(t,r),e(i,n)};this.on(t,r)}emit(t,e){var r=this.eventListeners[t];r&&[...r].forEach((t=>{t(this,e)}))}removeAllListeners(){this.eventListeners={}}}e("E",h);class u{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function d(t,e,r){var i=t.createShader(e);if(!i)throw new Error;if(t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}class c extends u{constructor(t){super(),n(this,"boundBufferCollection",null),n(this,"buffersBound",!1),n(this,"program",void 0),n(this,"vao",void 0),n(this,"renderer",void 0),n(this,"glw",void 0),n(this,"attributeBuffers",void 0),n(this,"attributeLocations",void 0),n(this,"attributeNames",void 0),n(this,"uniformLocations",void 0),n(this,"uniformTypes",void 0),n(this,"supportsIndexedTextures",void 0);var e=this.renderer=t.renderer,r=this.glw=this.renderer.glw;this.supportsIndexedTextures=t.supportsIndexedTextures||!1;var i=r.isWebGl2(),s=i&&t.webgl2Extensions||!i&&t.webgl1Extensions||[],a=i?"2.0":"1.0";s.forEach((t=>{if(!r.getExtension(t))throw new Error(`Shader "${this.constructor.name}" requires extension "${t}" for WebGL ${a} but wasn't found`)}));var o=t.shaderSources||this.constructor.shaderSources;if(!o)throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);i&&null!=o&&o.webGl2&&(o.fragment=o.webGl2.fragment,o.vertex=o.webGl2.vertex,delete o.webGl2);var h=e.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,u=o.vertex instanceof Function?o.vertex(h):o.vertex,c=o.fragment instanceof Function?o.fragment(h):o.fragment,l=d(r,r.VERTEX_SHADER,u),f=d(r,r.FRAGMENT_SHADER,c);if(!l||!f)throw new Error;var v=function(t,e,r){var i=t.createProgram();if(!i)throw new Error;if(t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return i;console.log(t.getProgramInfoLog(i)),t.deleteProgram(i)}(r,l,f);if(!v)throw new Error;if(this.program=v,i){var g=r.createVertexArray();if(!g)throw new Error;this.vao=g,r.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...t.attributes].forEach((t=>{var e=r.getAttribLocation(this.program,t);if(e<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${t}"!`);var i=r.createBuffer();if(!i)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${t}"`);this.attributeLocations[t]=e,this.attributeBuffers[t]=i,this.attributeNames.push(t)})),this.uniformLocations={},this.uniformTypes={},t.uniforms.forEach((t=>{var e=r.getUniformLocation(this.program,t.name);this.uniformTypes[t.name]=t.uniform,e?this.uniformLocations[t.name]=e:console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${t.name}"`)}))}bindBufferAttribute(t,e,r){var i=this.glw;i.enableVertexAttribArray(t),i.vertexAttribPointer(e,t,r.size,r.type,r.normalized,r.stride,r.offset)}disableAttribute(t){this.glw.disableVertexAttribArray(t)}disableAttributes(){for(var t in this.attributeLocations)this.disableAttribute(this.attributeLocations[t]);this.boundBufferCollection=null}canBatchShaderProps(t,e){return!1}bindRenderOp(t,e){this.bindBufferCollection(t.buffers),t.textures.length>0&&this.bindTextures(t.textures);var r=t.glw,i=t.parentHasRenderTexture;if(!t.renderToTexture||!i){if(i){var n=t.framebufferDimensions||{},s=n.width,o=n.height;this.setUniform("u_pixelRatio",1),this.setUniform("u_resolution",new Float32Array([null!=s?s:0,null!=o?o:0]))}else this.setUniform("u_pixelRatio",t.options.pixelRatio),this.setUniform("u_resolution",new Float32Array([r.canvas.width,r.canvas.height]));if(e){if(a(e,"$dimensions")){var h=e.$dimensions;h||(h=t.dimensions),this.setUniform("u_dimensions",[h.width,h.height])}if(a(e,"$alpha")){var u=e.$alpha;u||(u=t.alpha),this.setUniform("u_alpha",u)}this.bindProps(e)}}}setUniform(t,...e){this.glw.setUniform(this.uniformTypes[t],this.uniformLocations[t],...e)}bindBufferCollection(t){if(this.boundBufferCollection!==t){for(var e in this.attributeLocations){var r=t.getBuffer(e),i=t.getAttributeInfo(e);this.bindBufferAttribute(this.attributeLocations[e],r,i)}this.boundBufferCollection=t}}bindProps(t){}bindTextures(t){}attach(){this.glw.useProgram(this.program),this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}n(c,"shaderSources",void 0),e("W",c);class l extends h{constructor(t){super(),n(this,"txManager",void 0),n(this,"dimensions",null),n(this,"error",null),n(this,"state","freed"),n(this,"renderableOwners",new Set),this.txManager=t}setRenderableOwner(t,e){e?this.renderableOwners.add(t):this.renderableOwners.delete(t)}get renderable(){return this.renderableOwners.size>0}setState(t,...e){if(this.state!==t){if(this.state=t,"loaded"===t){var r=e;this.dimensions=r[0]}else if("failed"===t){var i=e;this.error=i[0]}this.emit(t,...e)}}static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}e("j",l);var f=e("b",(t=>[(t>>>24)/255,(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255]));function v(t,e,r,i,n){return n?(n.x1=t,n.y1=e,n.x2=r,n.y2=i,n):{x1:t,y1:e,x2:r,y2:i}}class g extends h{constructor(t,e){super(),n(this,"fontFamily",void 0),n(this,"descriptors",void 0),n(this,"loaded",!1),this.fontFamily=t,this.descriptors=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({style:"normal",weight:"normal",stretch:"normal"},e)}static convertToCssFontFaceDescriptors(t){return{style:t.style,weight:"number"==typeof t.weight?`${t.weight}`:t.weight,stretch:t.stretch,unicodeRange:t.unicodeRange,variant:t.variant,featureSettings:t.featureSettings,display:t.display}}}e("T",g);class p{constructor(t,e){n(this,"memManager",void 0),n(this,"textureSource",void 0),this.memManager=t,this.textureSource=e}}class E{constructor(t){n(this,"stage",void 0),this.stage=t}}class T{}class x extends T{constructor(t,e,r,i,s,a,o,h,u,d,c,l,f){super(),n(this,"glw",void 0),n(this,"options",void 0),n(this,"buffers",void 0),n(this,"shader",void 0),n(this,"shaderProps",void 0),n(this,"alpha",void 0),n(this,"clippingRect",void 0),n(this,"dimensions",void 0),n(this,"bufferIdx",void 0),n(this,"zIndex",void 0),n(this,"renderToTexture",void 0),n(this,"parentHasRenderTexture",void 0),n(this,"framebufferDimensions",void 0),n(this,"length",0),n(this,"numQuads",0),n(this,"textures",[]),n(this,"maxTextures",void 0),this.glw=t,this.options=e,this.buffers=r,this.shader=i,this.shaderProps=s,this.alpha=a,this.clippingRect=o,this.dimensions=h,this.bufferIdx=u,this.zIndex=d,this.renderToTexture=c,this.parentHasRenderTexture=l,this.framebufferDimensions=f,this.maxTextures=i.supportsIndexedTextures?t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(t){var e=this.textures,r=this.maxTextures,i=e.findIndex((e=>e===t));if(-1!==i)return i;var n=e.length;return n>=r?4294967295:(this.textures.push(t),n)}draw(){var t=this.glw,e=this.shader,r=this.shaderProps,i=this.options;i.shManager.useShader(e),e.bindRenderOp(this,r);var n=this.bufferIdx/24*6*2;if(this.clippingRect.valid){var s=this.clippingRect,a=s.x,o=s.y,h=s.width,u=s.height,d=i.pixelRatio,c=i.canvas.height,l=Math.round(a*d),f=Math.round(h*d),v=Math.round(u*d),g=Math.round(c-v-o*d);t.setScissorTest(!0),t.scissor(l,g,f,v)}else t.setScissorTest(!1);t.drawElements(t.TRIANGLES,6*this.numQuads,t.UNSIGNED_SHORT,n)}}function _(t){var e={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(e).forEach((r=>{e[r]=t.getParameter(t[r])})),e}function m(t){var e={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(e).forEach((r=>{e[r]=t.getExtension(r)})),e}function R(t,e){var r,i,n=0;function s(){var s,a,o=r,h=arguments.length;t:for(;o;){if(o.args.length===arguments.length){for(a=0;a<h;a++)if(o.args[a]!==arguments[a]){o=o.next;continue t}return o!==r&&(o===i&&(i=o.prev),o.prev.next=o.next,o.next&&(o.next.prev=o.prev),o.next=r,o.prev=null,r.prev=o,r=o),o.val}o=o.next}for(s=new Array(h),a=0;a<h;a++)s[a]=arguments[a];return o={args:s,val:t.apply(null,s)},r?(r.prev=o,o.next=r):i=o,n===e.maxSize?(i=i.prev).next=null:n++,r=o,o.val}return e=e||{},s.clear=function(){r=null,i=null,n=0},s}e("p",x);var A=t=>t&&!(t&t-1),b=(t,e,r,i)=>{var n=3*t,s=3*(r-t)-n,a=1-n-s,o=3*e,h=3*(i-e)-o,u=1-o-h;return function(t){if(t>=1)return 1;if(t<=0)return 0;for(var e,r,i=.5,d=0;d<20;d++){if((r=t-i*(i*(i*a+s)+n))>-1e-8&&r<1e-8)return i*(i*(i*u+h)+o);if((e=i*(i*(3*a)+2*s)+n)>1e-10&&e<1e-10)break;i+=r/e}for(var c=0,l=1,f=0;f<20;f++){if((r=t-(i=.5*(c+l))*(i*(i*a+s)+n))>-1e-8&&r<1e-8)return i*(i*(i*u+h)+o);r<0?l=i:c=i}}};e("r",R((t=>{switch(t){case"linear":return function(t){return t};case"ease":return b(.25,.1,.25,1);case"ease-in":return b(.42,0,1,1);case"ease-out":return b(0,0,.58,1);case"ease-in-out":return b(.42,0,.58,1);case"ease-in-sine":case"ease-out-sine":return b(.12,0,.39,0);case"ease-in-out-sine":return b(.37,0,.63,1);case"ease-in-cubic":return b(.32,0,.67,0);case"ease-out-cubic":return b(.33,1,.68,1);case"ease-in-out-cubic":return b(.65,0,.35,1);case"ease-in-circ":return b(.55,0,1,.45);case"ease-out-circ":return b(0,.55,.45,1);case"ease-in-out-circ":return b(.85,0,.15,1);case"ease-in-back":return b(.36,0,.66,-.56);case"ease-out-back":return b(.34,1.56,.64,1);case"ease-in-out-back":return b(.68,-.6,.32,1.6);case"step-start":return function(){return 1};case"step-end":return function(t){return 1===t?1:0};default:var e="cubic-bezier(";if(t&&0===t.indexOf(e)){var r=t.substr(13,t.length-13-1).split(",");if(4!==r.length)return console.warn("Unknown timing function: "+t),function(t){return t};var i=parseFloat(r[0]||"0.42"),n=parseFloat(r[1]||"0"),s=parseFloat(r[2]||"1"),a=parseFloat(r[3]||"1");return isNaN(i)||isNaN(n)||isNaN(s)||isNaN(a)?(console.warn(" Unknown timing function: "+t),function(t){return t}):b(i,n,s,a)}return console.warn("Unknown timing function: "+t),function(t){return t}}})));Math.hypot||(Math.hypot=(...t)=>{for(var e=0,r=t.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var y=new Uint8Array([0,0,0,0]);class w extends p{constructor(t,e,r){super(e,r),n(this,"glw",void 0),n(this,"_nativeCtxTexture",null),n(this,"_state","freed"),n(this,"_w",0),n(this,"_h",0),this.glw=t}get ctxTexture(){return"freed"===this._state&&this.load(),this._nativeCtxTexture,this._nativeCtxTexture}get renderable(){return this.textureSource.renderable}get w(){return this._w}get h(){return this._h}load(){"loading"!==this._state&&"loaded"!==this._state&&(this._state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this.onLoadRequest().then((({width:t,height:e})=>{"freed"!==this._state&&(this._state="loaded",this._w=t,this._h=e,this.textureSource.setState("loaded",{width:t,height:e}))})).catch((t=>{this._state="failed",this.textureSource.setState("failed",t),console.error(t)})))}onLoadRequest(){var e=this;return r(t().mark((function r(){var i,n,s,a,o,h,u,d,c,l,f,v,g,p,E,T,x;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.glw,s=e.memManager,n.texImage2D(0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,null),s.setTextureMemUse(e,y.byteLength),t.next=5,null===(i=e.textureSource)||void 0===i?void 0:i.getTextureData();case 5:if(a=t.sent,e._nativeCtxTexture){t.next=9;break}return e._state,t.abrupt("return",{width:0,height:0});case 9:return o=0,h=0,e._nativeCtxTexture,n.activeTexture(0),a.data instanceof ImageBitmap||a.data instanceof ImageData||null!==(r=a.data)&&"object"==typeof r&&r.constructor&&"HTMLImageElement"===r.constructor.name?(u=a.data,o=u.width,h=u.height,n.bindTexture(e._nativeCtxTexture),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!a.premultiplyAlpha),n.texImage2D(0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,u),s.setTextureMemUse(e,o*h*4),(n.isWebGl2()||A(o)&&A(h))&&n.generateMipmap()):null===a.data?(o=0,h=0,n.bindTexture(e._nativeCtxTexture),n.texImage2D(0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,y),s.setTextureMemUse(e,y.byteLength)):"mipmaps"in a.data&&a.data.mipmaps?(c=a.data,l=c.mipmaps,f=c.width,v=void 0===f?0:f,g=c.height,p=void 0===g?0:g,E=c.type,T=c.glInternalFormat,x="ktx"===E?new DataView(null!==(d=l[0])&&void 0!==d?d:new ArrayBuffer(0)):l[0],n.bindTexture(e._nativeCtxTexture),n.compressedTexImage2D(0,T,v,p,0,x),n.texParameteri(n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_MIN_FILTER,n.LINEAR),s.setTextureMemUse(e,x.byteLength)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",a),t.abrupt("return",{width:o,height:h});case 15:case"end":return t.stop()}var r}),r)})))()}free(){if("freed"!==this._state&&(this._state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,this._nativeCtxTexture)){var t=this.glw,e=this.memManager;t.deleteTexture(this._nativeCtxTexture),e.setTextureMemUse(this,0),this._nativeCtxTexture=null}}createNativeCtxTexture(){var t=this.glw,e=t.createTexture();if(!e)throw new Error("Could not create WebGL Texture");return t.activeTexture(0),t.bindTexture(e),t.texParameteri(t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e}}class S extends l{constructor(t,e){super(t),n(this,"props",void 0),this.props=S.resolveDefaults(e||{})}get color(){return this.props.color}set color(t){this.props.color=t}getTextureData(){var e=this;return r(t().mark((function r(){var i,n;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new Uint32Array([e.color]),n=new Uint8ClampedArray(i.buffer),t.abrupt("return",{data:new ImageData(n,1,1),premultiplyAlpha:!0});case 3:case"end":return t.stop()}}),r)})))()}static makeCacheKey(t){return`ColorTexture,${S.resolveDefaults(t).color}`}static resolveDefaults(t){return{color:t.color||4294967295}}}n(S,"z$__type__Props",void 0),e("u",S);class M extends l{constructor(t,e){super(t),n(this,"props",void 0),n(this,"parentTexture",void 0),n(this,"onParentTxLoaded",(()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})})),n(this,"onParentTxFailed",((t,e)=>{this.setState("failed",e)})),this.parentTexture=this.txManager.loadTexture(e.texture.txType,e.texture.props,e.texture.options),this.props=M.resolveDefaults(e||{}),queueMicrotask((()=>{var t=this.parentTexture;"loaded"===t.state?this.onParentTxLoaded(t,t.dimensions):"failed"===t.state&&this.onParentTxFailed(t,t.error),t.on("loaded",this.onParentTxLoaded),t.on("failed",this.onParentTxFailed)}))}getTextureData(){var e=this;return r(t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{data:e.props});case 1:case"end":return t.stop()}}),r)})))()}static makeCacheKey(t){return!1}static resolveDefaults(t){return{texture:t.texture,x:t.x||0,y:t.y||0,width:t.width||0,height:t.height||0}}}n(M,"z$__type__Props",void 0),e("v",M);class I extends w{constructor(t,e,r){super(t,e,r)}onLoadRequest(){var e=this;return r(t().mark((function r(){var i,n,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.textureSource.getTextureData();case 2:return s=t.sent,t.abrupt("return",{width:(null===(i=s.data)||void 0===i?void 0:i.width)||0,height:(null===(n=s.data)||void 0===n?void 0:n.height)||0});case 4:case"end":return t.stop()}}),r)})))()}}class L{constructor(t){n(this,"config",void 0),this.config=t}getBuffer(t){var e;return null===(e=this.config.find((e=>e.attributes[t])))||void 0===e?void 0:e.buffer}getAttributeInfo(t){var e;return null===(e=this.config.find((e=>e.attributes[t])))||void 0===e?void 0:e.attributes[t]}}e("B",L);class N{constructor(t){n(this,"gl",void 0),n(this,"activeTextureUnit",0),n(this,"texture2dUnits",void 0),n(this,"texture2dParams",new WeakMap),n(this,"scissorEnabled",void 0),n(this,"scissorX",void 0),n(this,"scissorY",void 0),n(this,"scissorWidth",void 0),n(this,"scissorHeight",void 0),n(this,"blendEnabled",void 0),n(this,"blendSrcRgb",void 0),n(this,"blendDstRgb",void 0),n(this,"blendSrcAlpha",void 0),n(this,"blendDstAlpha",void 0),n(this,"boundArrayBuffer",void 0),n(this,"boundElementArrayBuffer",void 0),n(this,"curProgram",void 0),n(this,"programUniforms",new WeakMap),n(this,"canvas",void 0),n(this,"MAX_RENDERBUFFER_SIZE",void 0),n(this,"MAX_TEXTURE_SIZE",void 0),n(this,"MAX_VIEWPORT_DIMS",void 0),n(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS",void 0),n(this,"MAX_TEXTURE_IMAGE_UNITS",void 0),n(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS",void 0),n(this,"MAX_VERTEX_ATTRIBS",void 0),n(this,"MAX_VARYING_VECTORS",void 0),n(this,"MAX_VERTEX_UNIFORM_VECTORS",void 0),n(this,"MAX_FRAGMENT_UNIFORM_VECTORS",void 0),n(this,"TEXTURE_MAG_FILTER",void 0),n(this,"TEXTURE_MIN_FILTER",void 0),n(this,"TEXTURE_WRAP_S",void 0),n(this,"TEXTURE_WRAP_T",void 0),n(this,"LINEAR",void 0),n(this,"CLAMP_TO_EDGE",void 0),n(this,"RGBA",void 0),n(this,"UNSIGNED_BYTE",void 0),n(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL",void 0),n(this,"UNPACK_FLIP_Y_WEBGL",void 0),n(this,"FLOAT",void 0),n(this,"TRIANGLES",void 0),n(this,"UNSIGNED_SHORT",void 0),n(this,"ONE",void 0),n(this,"ONE_MINUS_SRC_ALPHA",void 0),n(this,"VERTEX_SHADER",void 0),n(this,"FRAGMENT_SHADER",void 0),n(this,"STATIC_DRAW",void 0),n(this,"COMPILE_STATUS",void 0),n(this,"LINK_STATUS",void 0),n(this,"DYNAMIC_DRAW",void 0),n(this,"COLOR_ATTACHMENT0",void 0),this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map(((e,r)=>(this.activeTexture(r),t.getParameter(t.TEXTURE_BINDING_2D)))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);var r=t.getParameter(t.SCISSOR_BOX);this.scissorX=r[0],this.scissorY=r[1],this.scissorWidth=r[2],this.scissorHeight=r[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0}isWebGl2(){return t=this.gl,self.WebGL2RenderingContext&&t instanceof self.WebGL2RenderingContext;var t}activeTexture(t){var e=this.gl;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){var e=this.gl,r=this.activeTextureUnit,i=this.texture2dUnits;i[r]!==t&&(i[r]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){var t=this.activeTextureUnit;return this.texture2dUnits[t]}texParameteri(t,e){var r=this.gl,i=this.texture2dParams,n=this._getActiveTexture();if(!n)throw new Error("No active texture");var s=i.get(n);s||(s={},i.set(n,s)),s[t]!==e&&(s[t]=e,r.texParameteri(r.TEXTURE_2D,t,e))}texImage2D(t,e,r,i,n,s,a,o){var h=this.gl;s?h.texImage2D(h.TEXTURE_2D,t,e,r,i,n,s,a,o):h.texImage2D(h.TEXTURE_2D,t,e,r,i,n)}compressedTexImage2D(t,e,r,i,n,s){var a=this.gl;a.compressedTexImage2D(a.TEXTURE_2D,t,e,r,i,n,s)}pixelStorei(t,e){this.gl.pixelStorei(t,e)}generateMipmap(){var t=this.gl;t.generateMipmap(t.TEXTURE_2D)}createTexture(){return this.gl.createTexture()}deleteTexture(t){var e=this.gl;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}viewport(t,e,r,i){this.gl.viewport(t,e,r,i)}clearColor(t,e,r,i){this.gl.clearColor(t,e,r,i)}setScissorTest(t){var e=this.gl;t!==this.scissorEnabled&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,r,i){var n=this.gl,s=this.scissorX,a=this.scissorY,o=this.scissorWidth,h=this.scissorHeight;t===s&&e===a&&r===o&&i===h||(n.scissor(t,e,r,i),this.scissorX=t,this.scissorY=e,this.scissorWidth=r,this.scissorHeight=i)}setBlend(t){var e=this.gl;t!==this.blendEnabled&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){var r=this.gl,i=this.blendSrcRgb,n=this.blendDstRgb,s=this.blendSrcAlpha,a=this.blendDstAlpha;t===i&&e===n&&t===s&&e===a||(r.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){return this.gl.createBuffer()}createFramebuffer(){return this.gl.createFramebuffer()}bindFramebuffer(t){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,r){var i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e,r)}clear(){var t=this.gl;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,r){var i=this.gl;this.boundArrayBuffer!==t&&(i.bindBuffer(i.ARRAY_BUFFER,t),this.boundArrayBuffer=t),i.bufferData(i.ARRAY_BUFFER,e,r)}elementArrayBufferData(t,e,r){var i=this.gl;this.boundElementArrayBuffer!==t&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,r)}vertexAttribPointer(t,e,r,i,n,s,a){var o=this.gl;this.boundArrayBuffer!==t&&(o.bindBuffer(o.ARRAY_BUFFER,t),this.boundArrayBuffer=t),o.vertexAttribPointer(e,r,i,n,s,a)}useProgram(t){var e=this.gl;this.curProgram!==t&&(e.useProgram(t),this.curProgram=t)}setUniform(t,e,...r){var i=this.gl,n=this.programUniforms,s=n.get(this.curProgram);s||(s=new Map,n.set(this.curProgram,s));var a=s.get(e);a&&function(t,e){if(t.length!==e.length)return!1;return t.every(((t,r)=>!(Array.isArray(t)||t instanceof Float32Array)&&t===e[r]))}(a,r)||(s.set(e,r),i[t](e,...r))}getParameter(t){return this.gl.getParameter(t)}drawElements(t,e,r,i){this.gl.drawElements(t,e,r,i)}getExtension(t){return this.gl.getExtension(t)}createVertexArray(){var t=this.gl;return WebGL2RenderingContext,t.createVertexArray()}bindVertexArray(t){var e=this.gl;WebGL2RenderingContext,e.bindVertexArray(t)}getAttribLocation(t,e){return this.gl.getAttribLocation(t,e)}getUniformLocation(t,e){return this.gl.getUniformLocation(t,e)}enableVertexAttribArray(t){this.gl.enableVertexAttribArray(t)}disableVertexAttribArray(t){this.gl.disableVertexAttribArray(t)}createShader(t){return this.gl.createShader(t)}compileShader(t){this.gl.compileShader(t)}attachShader(t,e){this.gl.attachShader(t,e)}linkProgram(t){this.gl.linkProgram(t)}deleteProgram(t){this.gl.deleteProgram(t)}getShaderParameter(t,e){return this.gl.getShaderParameter(t,e)}getShaderInfoLog(t){return this.gl.getShaderInfoLog(t)}createProgram(){return this.gl.createProgram()}getProgramParameter(t,e){return this.gl.getProgramParameter(t,e)}getProgramInfoLog(t){return this.gl.getProgramInfoLog(t)}shaderSource(t,e){this.gl.shaderSource(t,e)}deleteShader(t){this.gl.deleteShader(t)}}class U extends l{constructor(t,e){super(t),n(this,"props",void 0),this.props=U.resolveDefaults(e||{})}get width(){return this.props.width}set width(t){this.props.width=t}get height(){return this.props.height}set height(t){this.props.height=t}getTextureData(){return r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{data:null,premultiplyAlpha:null});case 1:case"end":return t.stop()}}),e)})))()}static resolveDefaults(t){return{width:t.width||256,height:t.height||256}}}n(U,"z$__type__Props",void 0),e("R",U);class P extends w{constructor(t,e,r){super(t,e,r),n(this,"framebuffer",void 0);var i=t.createFramebuffer();this.framebuffer=i}onLoadRequest(){var e=this;return r(t().mark((function r(){var i,n,s,a,o,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.glw,n=e.memManager,s=e._nativeCtxTexture=e.createNativeCtxTexture(),a=e.textureSource,o=a.width,h=a.height,i.texImage2D(0,i.RGBA,o,h,0,i.RGBA,i.UNSIGNED_BYTE,null),n.setTextureMemUse(e,o*h*4),i.bindFramebuffer(e.framebuffer),i.framebufferTexture2D(i.COLOR_ATTACHMENT0,s,0),i.bindFramebuffer(null),t.abrupt("return",{width:o,height:h});case 9:case"end":return t.stop()}}),r)})))()}}class O extends E{constructor(t){super(t.stage),n(this,"glw",void 0),n(this,"system",void 0),n(this,"txManager",void 0),n(this,"txMemManager",void 0),n(this,"shManager",void 0),n(this,"options",void 0),n(this,"quadBuffer",new ArrayBuffer(4194304)),n(this,"fQuadBuffer",new Float32Array(this.quadBuffer)),n(this,"uiQuadBuffer",new Uint32Array(this.quadBuffer)),n(this,"renderOps",[]),n(this,"curBufferIdx",0),n(this,"curRenderOp",null),n(this,"rttNodes",[]),n(this,"activeRttNode",null),n(this,"defaultShader",void 0),n(this,"quadBufferCollection",void 0),n(this,"defaultTexture",void 0),n(this,"renderToTextureActive",!1);var e=t.canvas,r=t.clearColor,i=t.bufferMemory;this.options=t,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager,this.defaultTexture=new S(this.txManager),this.defaultTexture.once("loaded",(()=>{this.stage.requestRender()}));var s=function(t,e){var r={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},i=t.getContext("webgl",r)||t.getContext("experimental-webgl",r);if(!i)throw new Error("Unable to create WebGL context");return e?new Proxy(i,{get(t,r){var i=t[r];return"function"==typeof i?(e.increment(String(r)),i.bind(t)):i}}):i}(e,t.contextSpy),a=this.glw=new N(s),o=f(r);a.viewport(0,0,e.width,e.height),a.clearColor(o[0],o[1],o[2],o[3]),a.setBlend(!0),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),function(t,e){for(var r=~~(e/80),i=new Uint16Array(6*r),n=0,s=0;n<r;n+=6,s+=4)i[n]=s,i[n+1]=s+1,i[n+2]=s+2,i[n+3]=s+2,i[n+4]=s+1,i[n+5]=s+3;var a=t.createBuffer();t.elementArrayBufferData(a,i,t.STATIC_DRAW)}(a,i),this.system={parameters:_(this.glw),extensions:m(this.glw)},this.shManager.renderer=this,this.defaultShader=this.shManager.loadShader("DefaultShader").shader;var h=a.createBuffer(),u=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new L([{buffer:h,attributes:{a_position:{name:"a_position",size:2,type:a.FLOAT,normalized:!1,stride:u,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:a.FLOAT,normalized:!1,stride:u,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:a.UNSIGNED_BYTE,normalized:!0,stride:u,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:a.FLOAT,normalized:!1,stride:u,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){var t=this.glw;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,t.setScissorTest(!1),t.clear()}getShaderManager(){return this.shManager}createCtxTexture(t){return t instanceof M?new I(this.glw,this.txMemManager,t):t instanceof U?new P(this.glw,this.txMemManager,t):new w(this.glw,this.txMemManager,t)}addQuad(t){var e,r,i,n=this.fQuadBuffer,s=this.uiQuadBuffer,o=t.width,h=t.height,u=t.colorTl,d=t.colorTr,c=t.colorBl,l=t.colorBr,f=t.textureOptions,v=t.shader,g=t.shaderProps,p=t.alpha,E=t.clippingRect,T=t.tx,x=t.ty,_=t.ta,m=t.tb,R=t.tc,A=t.td,b=t.rtt,y=t.parentHasRenderTexture,w=t.framebufferDimensions,S=t.texture;if(g&&a(g,"$dimensions")){var I=g.$dimensions;I.width=o,I.height=h}S=null!==(e=S)&&void 0!==e?e:this.defaultTexture;var L=this.curBufferIdx,N=this.curRenderOp,U={width:o,height:h},P=v||this.defaultShader;this.reuseRenderOp(t)||(this.newRenderOp(P,g,p,U,E,L,b,y,w),N=this.curRenderOp);var O=null!==(r=null==f?void 0:f.flipX)&&void 0!==r&&r,B=null!==(i=null==f?void 0:f.flipY)&&void 0!==i&&i,D=0,X=0,C=1,G=1;if(S instanceof M){var F=S.props,V=F.x,W=F.y,k=F.width,Y=F.height,H=S.parentTexture.dimensions||{width:0,height:0},j=H.width,$=void 0===j?0:j,z=H.height,q=void 0===z?0:z;C=(D=V/$)+k/$,G=(X=W/q)+Y/q,S=S.parentTexture}if(O){var K=[C,D];D=K[0],C=K[1]}if(B){var Q=[G,X];X=Q[0],G=Q[1]}var Z=this.stage.txManager.getCtxTexture(S),J=this.addTexture(Z,L);if(N=this.curRenderOp,0!==m||0!==R)n[L++]=T,n[L++]=x,n[L++]=D,n[L++]=X,s[L++]=u,n[L++]=J,n[L++]=T+o*_,n[L++]=x+o*R,n[L++]=C,n[L++]=X,s[L++]=d,n[L++]=J,n[L++]=T+h*m,n[L++]=x+h*A,n[L++]=D,n[L++]=G,s[L++]=c,n[L++]=J,n[L++]=T+o*_+h*m,n[L++]=x+o*R+h*A,n[L++]=C,n[L++]=G,s[L++]=l,n[L++]=J;else{var tt=T+o*_,et=x+h*A;n[L++]=T,n[L++]=x,n[L++]=D,n[L++]=X,s[L++]=u,n[L++]=J,n[L++]=tt,n[L++]=x,n[L++]=C,n[L++]=X,s[L++]=d,n[L++]=J,n[L++]=T,n[L++]=et,n[L++]=D,n[L++]=G,s[L++]=c,n[L++]=J,n[L++]=tt,n[L++]=et,n[L++]=C,n[L++]=G,s[L++]=l,n[L++]=J}N.length+=24,N.numQuads++,this.curBufferIdx=L}newRenderOp(t,e,r,i,n,s,a,o,h){var u=new x(this.glw,this.options,this.quadBufferCollection,t,e,r,n,i,s,0,a,o,h);this.curRenderOp=u,this.renderOps.push(u)}addTexture(t,e,r){var i=this.curRenderOp,n=i.addTexture(t);if(4294967295===n){if(r)throw new Error("Unable to add texture to render op");var s=i.shader,a=i.shaderProps,o=i.dimensions,h=i.clippingRect,u=i.alpha;return this.newRenderOp(s,a,u,o,h,e),this.addTexture(t,e,!0)}return n}reuseRenderOp(t){var e,r,i,n=t.shader,s=t.shaderProps,a=t.parentHasRenderTexture,o=t.rtt,h=t.clippingRect,u=n||this.defaultShader;return(null===(e=this.curRenderOp)||void 0===e?void 0:e.shader)===u&&(((r=this.curRenderOp.clippingRect)===(i=h)||null!==r&&null!==i&&r.x===i.x&&r.y===i.y&&r.width===i.width&&r.height===i.height)&&(!a&&!o&&!!(this.curRenderOp.shader===this.defaultShader||s&&this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,s))))}addRenderOp(t){this.renderOps.push(t),this.curRenderOp=null}render(t="screen"){var e,r=this.glw,i=this.quadBuffer,n=new Float32Array(i,0,this.curBufferIdx),s=null!==(e=this.quadBufferCollection.getBuffer("a_position"))&&void 0!==e?e:null;r.arrayBufferData(s,n,r.STATIC_DRAW),this.renderOps.forEach(((t,e)=>{t.draw()}))}renderToTexture(t){for(var e=0;e<this.rttNodes.length;e++)if(this.rttNodes[e]===t)return;this.rttNodes.unshift(t)}renderRTTNodes(){for(var t=this.glw,e=this.stage.txManager,r=0;r<this.rttNodes.length;r++){var i=this.rttNodes[r];if(i&&i.hasRTTupdates){this.activeRttNode=i,i.texture;var n=e.getCtxTexture(i.texture);this.renderToTextureActive=!0,t.bindFramebuffer(n.framebuffer),t.viewport(0,0,n.w,n.h),t.clear();for(var s=0;s<i.children.length;s++){var a=i.children[s];a&&(a.update(this.stage.deltaTime,{x:0,y:0,width:0,height:0,valid:!1}),this.stage.addQuads(a),a.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,i.hasRTTupdates=!1}}t.bindFramebuffer(null),t.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}}e("w",O);var B=10;class D{}class X extends D{constructor(t,e){super(),n(this,"data",void 0),n(this,"glyphMap",void 0),n(this,"kernings",void 0),this.data=t,this.glyphMap=e;var r=this.kernings={};t.kernings.forEach((t=>{var e=t.second;(r[e]=r[e]||{})[t.first]=t.amount})),this.kernings=r}shapeText(e,r){var i=this;return t().mark((function n(){var s,a,o,h,u,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=void 0;case 1:if(!(s=r.peek())||s.done){t.next=17;break}if(o=s.value,h=i.glyphMap.get(o),r.next(),void 0===h){t.next=12;break}return d=void 0!==a?((null===(u=i.kernings[h.id])||void 0===u?void 0:u[a])||0)+e.letterSpacing:0,a=h.id,t.next=10,{mapped:!0,glyphId:h.id,codepoint:o,cluster:r.lastIndex,xAdvance:h.xadvance+d,yAdvance:0,xOffset:h.xoffset+d,yOffset:h.yoffset,xBearing:0,yBearing:0,width:h.width,height:h.height};case 10:t.next=15;break;case 12:return o===B&&(a=void 0),t.next=15,{mapped:!1,codepoint:o,cluster:r.lastIndex};case 15:t.next=1;break;case 17:case"end":return t.stop()}}),n)}))()}}e("S",class extends g{constructor(e,i,s,a,o,h){var u;super(e,i),u=this,n(this,"type",void 0),n(this,"texture",void 0),n(this,"maxCharHeight",0),n(this,"data",void 0),n(this,"shaper",void 0),n(this,"glyphMap",new Map),this.type=s;a.renderer;this.texture=a.txManager.loadTexture("ImageTexture",{src:o,premultiplyAlpha:!1},{preload:!0}),this.texture.on("loaded",(()=>{this.checkLoaded()})),fetch(h).then(function(){var e=r(t().mark((function e(r){var i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.json();case 2:u.data=t.sent,i=0,u.data.chars.forEach((t=>{u.glyphMap.set(t.id,t);var e=t.yoffset+t.height;e>i&&(i=e)})),u.maxCharHeight=i,u.shaper=new X(u.data,u.glyphMap),u.checkLoaded();case 8:case"end":return t.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch(console.error)}getAtlasEntry(t){var e=this.glyphMap.get(t);if(void 0===e)throw new Error(`Glyph ${t} not found in font ${this.fontFamily}`);return{x:e.x,y:e.y,width:e.width,height:e.height}}checkLoaded(){this.loaded||"loaded"===this.texture.state&&this.data&&(this.loaded=!0,this.emit("loaded"))}});e("C",class{})}}}))}();
//# sourceMappingURL=CoreExtension-legacy-1r1p_2oI.js.map

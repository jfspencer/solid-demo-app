{"version":3,"file":"Entity-O2XBGuQ9.js","sources":["../../src/api/providers/entity.js","../../src/pages/Entity.tsx"],"sourcesContent":["import api, { getImageUrl } from \"..\";\nimport { convertItemsToTiles } from \"../formatters/ItemFormatter\";\n\nexport function minutesToHMM(minutes) {\n  const hours = Math.floor(minutes / 60);\n  const remainingMinutes = minutes % 60;\n  return (\n    hours + \"h \" + (remainingMinutes < 10 ? \"0\" : \"\") + remainingMinutes + \"min\"\n  );\n}\n\nfunction formatDate(dateString) {\n  const parts = dateString.split(\"-\");\n  return parts[1] + \"/\" + parts[2] + \"/\" + parts[0];\n}\n\nfunction justYear(dateString) {\n  const parts = dateString.split(\"-\");\n  return parts[0];\n}\n\nexport function getRecommendations({ type, id }) {\n  return api.get(`/${type}/${id}/recommendations`).then(({ results }) => {\n    if (results.length) {\n      return convertItemsToTiles(results.slice(0, 7));\n    }\n    return api\n      .get(`/trending/${type}/week?page=1`)\n      .then(({ results }) => convertItemsToTiles(results.slice(0, 7)));\n  });\n}\n\nexport function getCredits({ type, id }) {\n  return api\n    .get(`/${type}/${id}/credits`)\n    .then(({ cast }) => convertItemsToTiles(cast.slice(0, 7)));\n}\n\nexport function getInfo({ type, id }) {\n  let rt =\n    type === \"movie\"\n      ? {\n          rtCrit: 86,\n          rtFan: 92,\n        }\n      : {};\n\n  return api.get(`/${type}/${id}`).then((data) => ({\n    backgroundImage: getImageUrl(data.backdrop_path, \"w1280\"),\n    heroContent: {\n      title: data.title || data.name,\n      description: data.overview,\n      badges: [\"HD\", \"CC\"],\n      voteAverage: data.vote_average,\n      voteCount: data.vote_count,\n      metaText:\n        type === \"movie\"\n          ? minutesToHMM(data.runtime) + \"   \" + formatDate(data.release_date)\n          : `${justYear(data.first_air_date)} - ${justYear(data.last_air_date)}`,\n      reviews: rt,\n    },\n    ...data,\n  }));\n}\n","import {\n  ElementNode,\n  Text,\n  View,\n  Show,\n  assertTruthy,\n  setActiveElement,\n} from \"@lightningtv/solid\";\nimport { Column, Button, Row } from \"@lightningtv/solid-ui\";\nimport { useParams } from \"@solidjs/router\";\nimport { createEffect, createResource, on, createSignal } from \"solid-js\";\nimport { TileRow } from \"../components\";\nimport { setGlobalBackground } from \"../state\";\nimport ContentBlock from \"../components/ContentBlock\";\nimport { useNavigate } from \"@solidjs/router\";\nimport styles from \"../styles\";\nimport * as provider from \"../api/providers/entity\";\nimport type { Tile } from \"../api/formatters/ItemFormatter\";\nimport { playVideo, closeVideo } from \"../video\";\n\nconst Entity = () => {\n  const params = useParams();\n  const navigate = useNavigate();\n\n  const [data] = createResource(() => ({ ...params }), provider.getInfo);\n  const [credits] = createResource<any, Tile[]>(\n    () => ({ ...params }),\n    provider.getCredits\n  );\n  const [recommendations] = createResource<any, Tile[]>(\n    () => ({ ...params }),\n    provider.getRecommendations\n  );\n  const [backdropAlpha, setBackdropAlpha] = createSignal(0);\n\n  createEffect(\n    on(\n      data,\n      (data) => {\n        setGlobalBackground(data.backgroundImage);\n      },\n      { defer: true }\n    )\n  );\n\n  const columnY = 640;\n\n  const Backdrop = {\n    color: \"#000000\",\n    alpha: 0,\n    width: 1900,\n    height: 890,\n    x: -160,\n    y: columnY,\n    borderRadius: 30,\n  };\n\n  function onRowFocus(this: ElementNode) {\n    this.children[this.selected || 0].setFocus();\n    columnRef.y = columnY;\n    backdropRef.y = columnY;\n    backdropRef.alpha = 0;\n  }\n\n  function onRowFocusAnimate(this: ElementNode) {\n    this.children[this.selected || 0].setFocus();\n    columnRef.y = 200;\n    backdropRef.y = 160;\n    backdropRef.alpha = 0.9;\n  }\n\n  function onEnter(this: ElementNode) {\n    let entity = this.children.find((c) => c.states!.has(\"focus\"));\n    assertTruthy(entity && entity.href);\n    navigate(entity.href);\n  }\n\n  function onEscape() {\n    closeVideo();\n    // Set focus back to lightning app\n    document.getElementsByTagName(\"canvas\")[0].focus();\n    entityActions.setFocus();\n    setBackdropAlpha(0);\n  }\n\n  function onEnterTrailer() {\n    const video = playVideo();\n    setActiveElement(video);\n    setBackdropAlpha(0.9);\n  }\n\n  let columnRef, backdropRef, entityActions;\n\n  /**\n   * I used to have keyed on Show - This would cause the entire tree to be destroyed and recreated. Without keyed, the data is diffed and the nodes are reused and passed in new props.\n   * Only one element gets deleted and recreated - a text node for reviews.\n   *\n   * However this causes problems with elements which have internal state like Row & Column because the selected does not get reset.\n   */\n  return (\n    <Show when={data()}>\n      <View x={170} onUp={() => entityActions.setFocus()} onEscape={onEscape}>\n        <ContentBlock y={260} content={data().heroContent}></ContentBlock>\n        <Row\n          ref={entityActions}\n          y={500}\n          scroll=\"none\"\n          height={90}\n          width={640}\n          gap={40}\n          onDown={() => columnRef.setFocus()}\n          onEnter={onEnterTrailer}\n        >\n          <Button width={300} autofocus={data()}>\n            Play\n          </Button>\n          <Button width={300}>Resume</Button>\n        </Row>\n\n        <Column\n          ref={columnRef}\n          x={0}\n          y={columnY}\n          style={styles.Column}\n          height={880}\n          scroll=\"none\"\n          zIndex={5}\n        >\n          <Show when={recommendations() && credits()}>\n            <Text skipFocus style={styles.RowTitle}>\n              Recommendations\n            </Text>\n            <TileRow\n              onFocus={onRowFocus}\n              onEnter={onEnter}\n              items={recommendations()}\n              width={1620}\n            />\n            <Text skipFocus style={styles.RowTitle}>\n              Cast and Crew\n            </Text>\n            <TileRow\n              onFocus={onRowFocusAnimate}\n              onEnter={onEnter}\n              items={credits()}\n              width={1620}\n            />\n          </Show>\n        </Column>\n        <View\n          ref={backdropRef}\n          style={Backdrop}\n          transition={{ alpha: true, y: true }}\n        />\n      </View>\n      <View\n        alpha={backdropAlpha()}\n        color={\"#000000\"}\n        skipFocus\n        zIndex={200}\n        transition={{ alpha: true }}\n      />\n    </Show>\n  );\n};\n\nexport default Entity;\n"],"names":["results","Entity","params","useParams","navigate","useNavigate","data","createResource","provider","credits","recommendations","backdropAlpha","setBackdropAlpha","createSignal","on","setGlobalBackground","backgroundImage","defer","columnY","Backdrop","color","alpha","width","height","x","y","borderRadius","onRowFocus","children","selected","setFocus","columnRef","backdropRef","onRowFocusAnimate","onEnter","entity","find","c","states","has","href","onEscape","document","getElementsByTagName","focus","entityActions","onEnterTrailer","video","playVideo","setActiveElement","_$createComponent","Show","when","View","onUp","ContentBlock","content","heroContent","Row","ref","r$","_ref$","scroll","gap","onDown","Button","autofocus","Column","_ref$2","style","styles","zIndex","_$memo","Text","skipFocus","RowTitle","TileRow","onFocus","items","_ref$3","transition"],"mappings":"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"}